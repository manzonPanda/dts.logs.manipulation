<!DOCTYPE html>
<html>
<head>
<style>
	.footer{
		position:fixed;
		left:0;
		bottom:0;
		width: 100%;
		background-color: lightgrey;
		color:white;
		text-align: right;
	}
</style>
</head>
<body>
		<table id="abendsTable">
            <thead>
                <th >Jobname</th>
                <th >Site</th>
                <th >Date</th>
                <th >Time</th>
                <th>Action</th>
                <th >Time of action</th>
            </thead>
			<tbody id="abendsTbody">
			<tbody>
        </table>
		<br>
		<table id="longRunningTable" >
            <thead >
                <th >Jobname</th>
                <th >Site</th>
				<th >Date</th>
                <th >Time</th>
                <th >Action</th>
                <th>Team</th>
                <th >Time of action</th>
            </thead>
			<tbody id="longRunningTbody" >
			<tbody>
        </table>
		<br><br><br>
	
		FolderName: <input type="text" id="folderName" value="tempNovember"><br>
		SignatureName: <input type="text" id="signatureName"value="Jake James Manzon"><br>
		Abend-Notify-Keywords: <input type="text" id="abendNotifyKeywords" value="advise;check and advise;Updating abends;Updating"><br>
		Abend-RR-Keywords: <input type="text" id="rerunKeywords" value="been rerun;RECOVERY FAILED"><br>
		Abend-MC-Keywords: <input type="text" id="mcKeywords" value="NO RECOVERY REQUIRED;marked"><br>
		Abend-LongRunning-Keywords: <input type="text" id="longRunningKeywords" value="running"><br>
		<br>
		Notify-Minute: <input type="number"id="notifyMinute"  min="1" value="3"><br>
		Rerun-Minute: <input type="number" id="rerunMinute" min="1" value="5"><br>
		MC-Minute: <input type="number" id="mcMinute" min="1"  value="0"><br>
		LongRunning-Minute: <input type="number" id="longRunningMinute" min="1" value="4"><br>
		<br>
		
		<button type="button" onclick="inputValidation()"> CREATE LOGS</button>
	
		<!--<div class="footer">
				<p>Â© Nov 2019 Made by <a href="#">Jake</a> and <a href="#">Duke</a> :)	</p>
		</div>
		-->
      
</body>
<script>
		var rerunMinute = 0; 
		var notifyMinute = 0; 
		var markCompleteMinute = 0; 
		var longRunningMinute = 0;
		
		function inputValidation(){
			var folderName = document.getElementById("folderName").value;
			var signatureName = document.getElementById("signatureName").value;
			var abendNotifyKeywords = document.getElementById("abendNotifyKeywords").value;
			var rerunKeywords = document.getElementById("rerunKeywords").value;
			var mcKeywords = document.getElementById("mcKeywords").value;
			var longRunningKeywords = document.getElementById("longRunningKeywords").value;
				folderName=='' ? folderName = 'tempNovember' : ''
				signatureName=='' ? signatureName = 'Jake James Manzon' : ''
				abendNotifyKeywords=='' ? abendNotifyKeywords = 'advise;check and advise;Updating abends;Updating' : ''
				rerunKeywords=='' ? rerunKeywords = 'been rerun;RECOVERY FAILED' : ''
				mcKeywords=='' ? mcKeywords = 'NO RECOVERY REQUIRED;marked' : ''
				longRunningKeywords=='' ? longRunningKeywords = 'running' : ''
			var tempNotifyMinute = document.getElementById("notifyMinute").value;
			var tempRerunMinute = document.getElementById("rerunMinute").value;
			var tempMcMinute = document.getElementById("mcMinute").value;
			var tempLongRunningMinute = document.getElementById("longRunningMinute").value;
				tempNotifyMinute=='' ? notifyMinute = 0 : notifyMinute=tempNotifyMinute;
				tempRerunMinute=='' ? rerunMinute = 0 : rerunMinute=tempRerunMinute;
				tempMcMinute=='' ? markCompleteMinute = 0 : markCompleteMinute=tempMcMinute;
				tempLongRunningMinute=='' ? longRunningMinute = 0 : longRunningMinute=tempLongRunningMinute;
				
			//myBody.indexOf("advise")>0 ||myBody.indexOf("check and advise")>0 || myBody.indexOf("Updating abends")>0 || (myBody.indexOf("check")>0 && myBody.indexOf("WAITING T/S")>0 )|| myBody.indexOf("Updating")>0
			var newAbendNotifyKeywordsExpression ="";
			for( var a=0; a < abendNotifyKeywords.split(";").length; a++ ){
				newAbendNotifyKeywordsExpression += "myBody.indexOf('"+ abendNotifyKeywords.split(";")[a]+"')>0";
				a != abendNotifyKeywords.split(";").length-1 ? newAbendNotifyKeywordsExpression += " || " : "";
			}
			
			var newRerunKeywordsExpression ="";
			for( var r=0; r < rerunKeywords.split(";").length; r++ ){
				newRerunKeywordsExpression += "myBody.indexOf('"+ rerunKeywords.split(";")[r]+"')>0";
				r != rerunKeywords.split(";").length-1 ? newRerunKeywordsExpression += " || " : "";
			}			
			
			var newMcKeywordsExpression ="";
			for( var m=0; m < mcKeywords.split(";").length; m++ ){
				newMcKeywordsExpression += "myBody.indexOf('"+ mcKeywords.split(";")[m]+"')>0";
				m != mcKeywords.split(";").length-1 ? newMcKeywordsExpression += " || " : "";
			}			
			
			var newLongRunningKeywordsExpression ="";
			for( var l=0; l < longRunningKeywords.split(";").length; l++ ){
				newLongRunningKeywordsExpression += "myBody.indexOf('"+ longRunningKeywords.split(";")[l]+"')>0";
				l != longRunningKeywords.split(";").length-1 ? newLongRunningKeywordsExpression += " || " : "";
			}
			//start
			startEmailsManipulation(newAbendNotifyKeywordsExpression,newRerunKeywordsExpression,newMcKeywordsExpression,newLongRunningKeywordsExpression  );
		}
		
		var zjobs = [];
		var abendsTbody;
		var longRunningTbody;
		var site;
		var convertedDate;
		var recipients;
		
		function startEmailsManipulation(abendNotifyExpression,rerunExpression,mcExpression,longRunningExpression){
			var outlookApp = new ActiveXObject("Outlook.Application");
			var nameSpace = outlookApp.getNameSpace("MAPI");
			//nameSpace.logon("ja20076062@wipro.com","jjgm@WL6062",false,false);
			var mailFolder = nameSpace.GetDefaultFolder(6).Folders("tempNovember").Items.Item(1).ConversationTopic;
			var emails = nameSpace.GetDefaultFolder(6).Folders("tempNovember").Items;
			 abendsTbody = document.getElementById("abendsTbody");	
			 longRunningTbody = document.getElementById("longRunningTbody");	
			
			for( var i=1; i <= emails.count; i++ ){
				var theEmail = emails.Item(i);
				var myBody = theEmail.Body;
				var fullEmail = theEmail.Body;
				var limitUntilLine = theEmail.Body.indexOf("Jake James Manzon"); //limit the search area
				myBody = myBody.substring(0,limitUntilLine);
				
				var emailSubject = theEmail.ConversationTopic;

				//if( emailSubject.indexOf("ABEND") > 0 ){
				//	if( emailSubject.indexOf("*")>0 || emailSubject.indexOf("MULTIPLE")>0 || emailSubject.indexOf("&") > 0){ //multiple job
				//		zjobs = extractJobs(myBody);
				//	}else{ //single job
				//		var jobname =  emailSubject.split("|")[1].split(" ")[2];
				//		zjobs.push(jobname);
				//	}
				//}else{ 
				//	var jobname =  emailSubject.split("|")[1].split(" ")[2];
				//	zjobs.push(jobname);
				//}
				
				site = theEmail.ConversationTopic.split("|")[0].split(" ")[0];
				var myDate = theEmail.SentOn;
				convertedDate = new Date(myDate);
				recipients = theEmail.cc + theEmail.to; //to,cc,bcc

				//Time manipulation
				var emailTimeSent = theEmail.SentOn;
				var timeColumnConvertedDate = new Date(emailTimeSent);
				var tempDate = new Date();
				tempDate.setHours( timeColumnConvertedDate.getHours() );
				tempDate.setMinutes( timeColumnConvertedDate.getMinutes() );
				tempDate.setSeconds( timeColumnConvertedDate.getSeconds() );
				//var rerunMinute = 5; 
				//var notifyMinute = 3; 
				//var markCompleteMinute = 2; 
				//var longRunningMinute = 3;
				
				//find Action
				//if( emailSubject.indexOf("ABEND") > 0){ //abends
					var logType = "abend";
			//-> RR expression=> myBody.indexOf("been rerun")>0 || myBody.indexOf("RECOVERY FAILED") > 0
					if( eval(rerunExpression) ){ //rerun || RR as per ps25
						// || myBody.indexOf("RECOVERY FAILED") > 0
						var where = "RECOVERY";
						//singleOrMultipleJobs(emailSubject,myBody,where);
						//var emailSubject = "";
						extractJobs(emailSubject,myBody,where,fullEmail,tempDate);
						//console.log("email("+i +")-> rerun-"+zjobs.length+" found")
						//var action = "rerun as per programmer";
						//var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - rerunMinute )).toTimeString().split(" ")[0];
						//displayRow(zjobs,site,convertedDate,timeResult,action,logType,recipients);
					}
			//-> MC expression=> myBody.indexOf("NO RECOVERY REQUIRED")>0 || myBody.indexOf("marked") >0
					if( eval(mcExpression) ){ //mark complete
						var action = "";
						var timeResult;
						var where = "NO RECOVERY REQUIRED";
						//var emailSubject = "";
						//singleOrMultipleJobs(emailSubject,myBody,where);
						extractJobs(emailSubject,myBody,where,fullEmail);
						console.log("email("+i +")-> mc-"+zjobs.length+" found")
						if( myBody.indexOf("ps25")>0 || myBody.indexOf("ps22")>0){ //as per?ps25
							console.log(theEmail.Body.indexOf("ps25"))
							action = "mark complete as per ps25";
							timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - markCompleteMinute )).toTimeString().split(" ")[0];

							console.log("mcMinute: " +tempDate.getMinutes() - markCompleteMinute)
						}else{
							action = "mark complete as per programmer";
							timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - markCompleteMinute )).toTimeString().split(" ")[0];
						}
						displayRow(zjobs,site,convertedDate,timeResult,action,logType,recipients);
					}
			//-> Abend Notify expression=> myBody.indexOf("advise")>0 ||myBody.indexOf("check and advise")>0 || myBody.indexOf("Updating abends")>0 || (myBody.indexOf("check")>0 && myBody.indexOf("WAITING T/S")>0 )|| myBody.indexOf("Updating")>0
					if(  eval(abendNotifyExpression) || (myBody.indexOf("check")>0 && myBody.indexOf("WAITING T/S")>0 ) ){ // notify
						var action = "notify programmer";
						var where = "WAITING T/S"; //some email forgot the whole status
						var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - notifyMinute )).toTimeString().split(" ")[0];
						//singleOrMultipleJobs(emailSubject,myBody);
						extractJobs(emailSubject,myBody,where,fullEmail);
						console.log("email("+i +")-> notify-"+zjobs.length+" found")
						displayRow(zjobs,site,convertedDate,timeResult,action,logType,recipients);
					}
					
					//var logType = "abend";
					//displayRow(zjobs,site,convertedDate,timeResult,action,logType,recipients);
				
				//}else{ // long running
			//-> LR expression=> myBody.indexOf("running ") >0
					if( eval(longRunningExpression) ){
						var logType = "longRunning";
						var action = "long running";
						var where = "longRunning";			
						var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - longRunningMinute )).toTimeString().split(" ")[0];
						extractJobs(emailSubject,myBody,where,fullEmail);				
						console.log("email("+i +")-> longRun-" +zjobs.length+" found")
						displayRow(zjobs,site,convertedDate,timeResult,action,logType,recipients);
					}
				//}
				
				//console.log("Success!")
			}
		}

		function singleOrMultipleJobs(emailSubject,myBody,where){
			zjobs.length = 0; //empty the array
			//if( emailSubject.indexOf("ABEND") > 0 ){
			//	if( emailSubject.indexOf("*")>0 || emailSubject.indexOf("MULTIPLE")>0 || emailSubject.indexOf("&") > 0){ //multiple job
			//		zjobs = extractJobs(myBody);
			//	}else{ //single job
			//		var jobname =  emailSubject.split("|")[1].split(" ")[2];
			//		zjobs.push(jobname);
			//	}
			//}
		
		}
		function extractJobsNotify(emailSubject,myBody,where){
			zjobs = [];
			var myArray = myBody.split("\n");
			var result = [];
			if( emailSubject.indexOf("*")>0 || emailSubject.indexOf("MULTIPLE")>0 || emailSubject.indexOf("&") > 0){ //multiple job
				for( var j = 0; j < myArray.length; j++){
					var lineN = myArray[j];
					var myTable = document.getElementById("abendsTbody");
					if( lineN.indexOf("Z") >=0  ){ //if line has a char 'Z', then there is a job
						if( myTable.rows.length > 0 ){ //chech for duplicate jobs when notifying programmer || updating abends
							for (var i = 0; i < myTable.rows.length; i++) { 
							   if( (myTable.rows[i].childNodes[0].innerHTML).indexOf(lineN.substring(lineN.indexOf("Z"),8)) >=0 ){//if duplicate jobs
								//console.log((myTable.rows[i].childNodes[0].innerHTML).indexOf(lineN.substring(lineN.indexOf("Z"),8)) >=0)
								console.log( "Duplicate => " +(myTable.rows[i].childNodes[0].innerHTML) + " == " + lineN.substring(lineN.indexOf("Z"),8))
								return;
							   }
							} 
						}
						var zjobTemp = lineN.trim().substring(0,9)
						zjobs.push( zjobTemp ) //get only the Zjob

					}
				}

				
			}else{ //single job
				//var jobname =  emailSubject.split("|")[1].split(" ")[2];
				var jobname =  emailSubject.split("|")[1].split(" ")[2];
				zjobs.push(jobname);
			}
		}
		function extractJobs(emailSubject,myBody,where,fullEmail,tempDate){
			var zjobsTemp = [];
			var zjobsRecoveryActive = [];
			var zjobsRecoveryFailed = [];
			zjobs.length = 0;
			var myArray = myBody.split("\n");
			var mySecondArray = fullEmail.split("\n");
			var result = [];
			//get all zjobs first and then compare it to full email thread-if there is duplicate-then someone already report it
			for( var j = 0; j < myArray.length; j++){
				var lineN = myArray[j];
				//if( lineN.indexOf("Z") >= 0  ){ //if line has a char 'Z', then there is a job
					//console.log( lineN.substring(lineN.indexOf("Z"),8))//get all Zjobs 
				//	result.push( lineN.substring(lineN.indexOf("Z"),8) )
				//	if( myArray[j+2].indexOf("Z") < 0 ){
				//		break;
				//	}
				//}
				if( where == "longRunning" ){//long running
					if( lineN.trim().indexOf("Z") >= 0 && lineN.trim().indexOf("Z") < 3){
						var temp = lineN.trim().substring(0,8);
						zjobsTemp.push(temp);
						zjobs.push( temp )
					}
				}else{ //abend
					//get all zjobs first and then compare it to full email thread-if there is duplicate-then someone already report it
					if( lineN.trim().indexOf("Z") >= 0 && lineN.trim().indexOf("Z") <3 && lineN.indexOf(where) >= 0 ){
						if( where == "RECOVERY" ){ //RECOVERY ACTIVE || RECOVERY FAILED => job has been rerun || RR as ps25
							if( lineN.indexOf("RECOVERY ACTIVE") > 0 ){
								var temp = lineN.substring( lineN.indexOf("Z")).replace(/\s+/g, "-").split("-")[0];
								//zjobsTemp.push(temp);
								zjobsRecoveryActive.push( temp )
							}
							if( lineN.indexOf("RECOVERY FAILED") > 0 ){
								var temp = lineN.substring( lineN.indexOf("Z")).replace(/\s+/g, "-").split("-")[0];
								//zjobsTemp.push(temp);
								zjobsRecoveryFailed.push( temp )
							}
						}else{
							var temp = lineN.substring( lineN.indexOf("Z")).replace(/\s+/g, "-").split("-")[0];
							zjobsTemp.push(temp);
							zjobs.push( temp )
						}
					}

				}
				
				//if( lineN.indexOf(where) >= 0  ){
				//	var zjobTemp = lineN.trim().substring(0,9)//correct
				//	zjobs.push( zjobTemp )//correct
				//}

				//if( lineN.indexOf("Warm Regards") >= 0 ){
				//	return;
				//}
			}
								
			//console.log(zjobs) 
			if( where == "RECOVERY" ){ //rerun
				var splitFrom = fullEmail.split("From");
				if( zjobsRecoveryActive.length > 0 ){

					console.log(zjobsRecoveryActive) 
					//for( var s=0; s < zjobsRecoveryActive.length; s++ ){ //RR as programmer
						var logType = "abend";
						var action = "rerun as per programmer";
						var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - rerunMinute )).toTimeString().split(" ")[0];
						//var timeResult = "fix";
						//var oneAtATime = [];
						//oneAtATime.push(zjobsTemp[s])
						displayRow(zjobsRecoveryActive,site,convertedDate,timeResult,action,logType,recipients);
						//zjobs.splice( zjobs.indexOf(zjobsTemp[s]), 1) //remove job zjobs array
								
					//}
						console.log("email("+emailSubject +")-> rerun-"+zjobsRecoveryActive.length+" found")
				}
				console.log( "urMail:"+myArray.length + " : wholeMail"+mySecondArray.length)
				if( zjobsRecoveryFailed.length > 0 ){ //RR as programmer || RR as ps25
				
					console.log(zjobsRecoveryFailed) 
					var zjobsRRps25 = [];
					var zjobsRRprogrammer = [];
					var indexOfAutoEmail = 0;
					for( var y = myArray.length; y < mySecondArray.length; y++){ //clear zjobs that was rerun
						var lineN = mySecondArray[y];
						if( lineN.indexOf( "From: pcp2@msg.ti.com [mailto:pcp2@msg.ti.com] " ) >= 0  ){
							var from = lineN.indexOf( "From: dts@msg.ti.com [mailto:dts@msg.ti.com]" );
							var fromNumberline = mySecondArray.indexOf(mySecondArray[y]);
							indexOfAutoEmail = fromNumberline;
							//console.log(indexOfAutoEmail)
						}
						
						if( (lineN.indexOf( "Z" ) >= 0 && splitFrom.length>2) || (lineN.indexOf( "Z" ) >= 0 && lineN.indexOf( "RECOVERY" ) >0) || (lineN.indexOf( "Z" ) >= 0 && !(y>indexOfAutoEmail)) && y <= mySecondArray.length-1 ) {  //RR as programmer
							for( var h=0; h < zjobsRecoveryFailed.length; h++ ){//remove all duplicates
								if( lineN.trim().indexOf( zjobsRecoveryFailed[h] ) >=0  ){
									console.log("programmer")
									//zjobsRRprogrammer.push(zjobsRecoveryFailed[h] ) 
									zjobsRecoveryFailed.splice( zjobsRecoveryFailed.indexOf(zjobsTemp[h]), 1) //remove job zjobs array
					  //correct->  //zjobsRecoveryFailed.splice( zjobsRecoveryFailed.indexOf(zjobsTemp[h]), 1) //remove job zjobs array
									break;
								}
	
							}
							if( y == mySecondArray.length-1 && zjobsRecoveryFailed.length >= 0){
								console.log("in")
								zjobsRRprogrammer = zjobsRecoveryFailed;
							}
						}
						//console.log(splitFrom.length)
						if( (lineN.indexOf( "Z" ) >= 0 && splitFrom.length <=2 ) || splitFrom.length ==1 && y <= mySecondArray.length-1 ){ //RR as ps25
							for( var h=0; h < zjobsRecoveryFailed.length; h++ ){
								if( lineN.trim().indexOf( zjobsRecoveryFailed[h] ) >=0  ){
									console.log("ps25-1")
									zjobsRRps25.push(zjobsRecoveryFailed.splice( h-1, 1) ) 
									//console.log(zjobsRecoveryFailed.splice( zjobsRecoveryFailed.indexOf(zjobsRecoveryFailed[h]), 1)) //remove job zjobs array
									break;
								}
							}
							
							if(splitFrom.length ==1){
								console.log("ps25-2")
								for( var h=0; h < zjobsRecoveryFailed.length; h++ ){
									zjobsRRps25.push(zjobsRecoveryFailed[h] )
									zjobsRecoveryFailed.splice( h-1, 1) //remove job zjobs array
									break;
								}
							}
							
							if( y == mySecondArray.length-1 && zjobsRecoveryFailed.length > 0){
								zjobsRRps25 = zjobsRecoveryFailed;
							}
						

						}
						
						if( y == mySecondArray.length-1){
							console.log("point")
							console.log(zjobsRecoveryFailed)
							if( zjobsRRprogrammer.length >0 ){
								for( var h=0; h < zjobsRRprogrammer.length; h++ ){//RR as programmer
									var logType = "abend";
									var action = "rerun as per programmer";
									var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - rerunMinute )).toTimeString().split(" ")[0];
									//var timeResult = "fix";
									var oneAtATime = [];
									oneAtATime.push(zjobsRRprogrammer[h])
									displayRow(oneAtATime,site,convertedDate,timeResult,action,logType,recipients);
									console.log("email("+emailSubject +")-> rerunAsProgrammer- 1 found")
									zjobsRRprogrammer.splice( zjobsRRprogrammer.indexOf(zjobsTemp[h]), 1) //remove job zjobs array
									//console.log(zjobsTemp)
								}
							}
						}
					}
					//console.log(zjobsRecoveryFailed)
					
					//console.log(zjobsRRps25)
					if( zjobsRRps25.length > 0){
						for( var h=0; h < zjobsRRps25.length; h++ ){//RR as Ps25
							var logType = "abend";
							var action = "rerun as per ps25";
							var ps25TempDate = new Date(tempDate);
							var timeResult = new Date(ps25TempDate.setMinutes( ps25TempDate.getMinutes() - 0 )).toTimeString().split(" ")[0];
							//var timeResult = "fix";
							var oneAtATime = [];
							oneAtATime.push(zjobsRRps25[h])
							displayRow(oneAtATime,site,convertedDate,timeResult,action,logType,recipients);
							console.log("email("+emailSubject +")-> rerunAsPs25- 1 found")
							//zjobsTemp.splice( zjobsRecoveryFailed.indexOf(zjobsTemp[h]), 1) //remove job zjobs array
							//console.log(zjobsTemp)
						}	
					}
				}
		
				return;
			}
			
			if( where == "NO RECOVERY REQUIRED" || where == "RECOVERY" ){ //mc subjob || rerun subjob
				if( zjobs.length == 0 ){ //super job; found 0 in searching zjobs in forLoop() above;
					//var jobname =  emailSubject.split("|")[1].split(" ")[2];
					var jobname =  emailSubject.substring( emailSubject.indexOf("Z")).replace(/\s+/g, "").split("-")[0]; //best way of extracting zjob in subjectMail,
						zjobsTemp.push(jobname)
						zjobs = zjobsTemp;
						console.log(zjobsTemp)
				}
			}
			
			if( where == "longRunning" ){//for longRunning notify only
			 console.log(zjobs)
				var mySecondArray = fullEmail.split("\n");
				zjobs = zjobsTemp;
				//console.log(mySecondArray[1].indexOf("dts@msg.ti.com [mailto:dts@msg.ti.com]"));
				//only when notify || search job duplication in thread->don't notify
				for( var g = myArray.length; g < mySecondArray.length; g++){ 
					var lineN = mySecondArray[g];
					//var indexOfAutoEmail = 0;
					if( lineN.indexOf( "From: dts@msg.ti.com [mailto:dts@msg.ti.com]" ) >= 0  ){
						var from = lineN.indexOf( "From: dts@msg.ti.com [mailto:dts@msg.ti.com]" );
						var fromNumberline = mySecondArray.indexOf(mySecondArray[g]);
						var indexOfAutoEmail = fromNumberline;
						console.log(indexOfAutoEmail)
					}
					if( lineN.indexOf( "Z" ) >= 0 ){ 
						for( var h=0; h < zjobsTemp.length; h++ ){
							if( lineN.indexOf( zjobsTemp[h] ) >= 0  && !(g>indexOfAutoEmail)  ){//there is already job in threads until first line of AutoEmail
								//&& lineN.indexOf( zjobsTemp[m]) < fromNumberline
								//console.log( fromNumberline <  )
								console.log("!g<AE->" + g +"<"+indexOfAutoEmail )
								//console.log( lineN.indexOf( zjobsTemp[h] ) + " == " + lineN) //if found duplicate
								zjobs.splice( zjobsTemp.indexOf(zjobsTemp[h]), 1) //remove job zjobs array
							}
						}
					}
				}
			}
			
			if( where == "WAITING T/S"  ){ //notify programmer //for abend notify  only
			//console.log("here")
			//console.log(zjobs)
				if( zjobs.length == 0 ){ //single job; found 0 in searching zjobs for loop() above;
					var jobname =  emailSubject.split("|")[1].split(" ")[2];
					//zjobs.push(jobname);
					//console.log("in")
						zjobsTemp.push(jobname)
						console.log(zjobsTemp)
				}
			
				////////////////////////////////////////////////////
				//only when notify || search job duplication in thread
				//var mySecondArray = fullEmail.split("\n");
				zjobs = zjobsTemp;
				//if job was rerun failed,skip the for loop below, then notify
				for(var i=0; i < myArray.length; i++){
					var lineN = myArray[i];
					if( lineN.indexOf( "Z" ) >= 0 ){ 
						for( var m=0; m < zjobsTemp.length; m++ ){
							if( lineN.indexOf( zjobsTemp[m] )>= 0 && lineN.indexOf("RECOVERY FAILED") > 0 ){
								console.log("job rerun failed")
								return;
							}
						}
					}
				}

				//only when notify || search job duplication in thread->don't notify
				for( var l = myArray.length; l < mySecondArray.length; l++){
					var lineN = mySecondArray[l];
					if( lineN.indexOf( "Z" ) >= 0 ){
						for( var m=0; m < zjobsTemp.length; m++ ){
							//lineN.trim().indexOf("Z") >= 0 && lineN.trim().indexOf("Z") < 3
							//if( lineN.indexOf( zjobsTemp[m] ) >= 0 ){//there is already job in threads
							if( lineN.trim().indexOf( zjobsTemp[m] )>= 0 && lineN.trim().indexOf( zjobsTemp[m] ) <3 ){//there is already job in threads
								//&& lineN.indexOf( zjobsTemp[m]) < fromNumberline
								if( emailSubject.indexOf("LONG") <0  ){// if subjectName is longRunning-Abend, dont delete
									console.log( lineN.indexOf( zjobsTemp[m] ) + " == " + lineN)
									zjobs.splice( zjobsTemp.indexOf(zjobsTemp[m]), 1) //remove job zjobs array
								}
							}
						}
					}
				}
			}


			//zjobs = result;
			//return result;
			
			//var line12 = myBody.split("\n")[12]; 
			//console.log(myBody.split("\n")[12].indexOf("Z")); //extract every job
			//console.log(line12.substring(0, 11));
		}
		function displayRow(zjobs,site,convertedDate,timeResult,action,logType,recipients){
			//(logType == "abend") ? (var newRow = abendsTbody.insertRow(-1)):(var newRow = longRunningTbody.insertRow(-1));
			if( logType === "abend" ) {
				var newRow = abendsTbody.insertRow(-1)
			}else{
				var newRow = longRunningTbody.insertRow(-1)
			}

			if( zjobs.length == 1){ //single zjob
				//var newRow = abendsTbody.insertRow(-1)
				newRow.insertCell(-1).innerHTML = zjobs[0];
				newRow.insertCell(-1).innerHTML = site;
				newRow.insertCell(-1).innerHTML = convertedDate.toJSON().split("T")[0];
				newRow.insertCell(-1).innerHTML = timeResult;
				newRow.insertCell(-1).innerHTML = action;
				if(logType === "abend"){
					newRow.insertCell(-1).innerHTML = convertedDate.toTimeString().split(" ")[0];
				}
				if( logType == "longRunning" ) { //team
						if( recipients.indexOf("data_mart") > 0 ){
							var team = "Datamart";
						}else if ( recipients.indexOf("scssupport") > 0 ){
							var team = "SCS";
						}else if ( recipients.indexOf("dcit") > 0 ){
							var team = "Dcit";
						}else if ( recipients.indexOf("debatch") > 0 ){
							var team = "Debatch";
						}else if ( recipients.indexOf("logistic") > 0 ){
							var team = "Logistic";
						}else if ( recipients.indexOf("hrsprodsup") > 0 ){
							var team = "Hrsprodsup";
						}else if ( recipients.indexOf("firm") > 0 ){
							var team = "Firm";
						}else if ( recipients.indexOf("emk-dba") > 0 ){
							var team = "Emk-Dba";
						}else if ( recipients.indexOf("ap-mmpp") > 0 ){
							var team = "Ap-mmpp";
						}else if ( recipients.indexOf("sapbw") > 0 ){
							var team = "Sapbw";
						}else if ( recipients.indexOf("wwmit_qms") > 0 ){
							var team = "wwmit_qms";
						}else{
							var team = "SAP";//sap_yr
						}
						newRow.insertCell(-1).innerHTML = team;
						newRow.insertCell(-1).innerHTML = convertedDate.toTimeString().split(" ")[0];
					}
			}else{ //multiple zjobs
				for(var i=0; i< zjobs.length; i++ ){
					newRow.insertCell(-1).innerHTML = zjobs[i];
					newRow.insertCell(-1).innerHTML = site;
					newRow.insertCell(-1).innerHTML = convertedDate.toJSON().split("T")[0];
					newRow.insertCell(-1).innerHTML = timeResult;
					newRow.insertCell(-1).innerHTML = action;
					//newRow.insertCell(-1).innerHTML = convertedDate.toTimeString().split(" ")[0];
					
					if( logType == "longRunning" ) { //team
						if( recipients.indexOf("data_mart") > 0 ){
							var team = "Datamart";
						}else if ( recipients.indexOf("scssupport") > 0 ){
							var team = "SCS";
						}else if ( recipients.indexOf("dcit") > 0 ){
							var team = "Dcit";
						}else if ( recipients.indexOf("debatch") > 0 ){
							var team = "Debatch";
						}else if ( recipients.indexOf("logistic") > 0 ){
							var team = "Logistic";
						}else if ( recipients.indexOf("hrsprodsup") > 0 ){
							var team = "Hrsprodsup";
						}else if ( recipients.indexOf("firm") > 0 ){
							var team = "Firm";
						}else if ( recipients.indexOf("emk-dba") > 0 ){
							var team = "Emk-Dba";
						}else if ( recipients.indexOf("ap-mmpp") > 0 ){
							var team = "Ap-mmpp";
						}else if ( recipients.indexOf("sapbw") > 0 ){
							var team = "Sapbw";
						}else if ( recipients.indexOf("wwmit_qms") > 0 ){
							var team = "wwmit_qms";
						}else{
							var team = "SAP";//sap_yr
						}
						newRow.insertCell(-1).innerHTML = team;
						newRow.insertCell(-1).innerHTML = convertedDate.toTimeString().split(" ")[0];
					}
					
					
					if( i < zjobs.length-1){
						if( logType === "abend" ) {
							var newRow = abendsTbody.insertRow(-1)
						}else{
							var newRow = longRunningTbody.insertRow(-1)
						}
					}
				}
			}
		
			
			
				

		}
		

		//manipulate Time
		//var myDate = emails.Item(1).SentOn;
		//var convertedDate = new Date(myDate);
		//var minuteLess = new Date(convertedDate.setMinutes( convertedDate.getMinutes() - 5 )).toJSON().split("T")[1].split(".")[0];

	
		
		//Excell export..Jake please continue this:)
	//	var ExcelApp = new ActiveXObject("Excel.Application");  
	//var ExcelSheet = new ActiveXObject("Excel.Sheet");
		// Make Excel visible through the Application object.  
	//ExcelSheet.Application.Visible = true;  
	    // Place some text in the first cell of the sheet.  
	//ExcelSheet.ActiveSheet.Cells(1,1).Value = "This is column A, row 1";  
		// Save the sheet.  
	//ExcelSheet.SaveAs("C:\\TEST.XLS");  
		// Close Excel with the Quit method on the Application object.  
	//ExcelSheet.Application.Quit();
	
	</script>

</html>
