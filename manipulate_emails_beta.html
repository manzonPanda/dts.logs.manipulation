<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<!--
<script type="text/javascript" data-id="1" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>

<link rel="stylesheet" data-id="2" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

<link rel="stylesheet" data-id="3" type="text/css" href="https://cdn.datatables.net/v/bs4/jqc-1.12.4/jszip-2.5.0/dt-1.10.20/b-1.6.1/b-colvis-1.6.1/b-flash-1.6.1/b-html5-1.6.1/b-print-1.6.1/cr-1.5.2/fh-3.1.6/r-2.2.3/rr-1.2.6/sl-1.3.1/datatables.min.css"/> 
<script type="text/javascript" data-id="4" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
<script type="text/javascript" data-id="5" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
<script type="text/javascript" data-id="6" src="https://cdn.datatables.net/v/bs4/jqc-1.12.4/jszip-2.5.0/dt-1.10.20/b-1.6.1/b-colvis-1.6.1/b-flash-1.6.1/b-html5-1.6.1/b-print-1.6.1/cr-1.5.2/fh-3.1.6/r-2.2.3/rr-1.2.6/sl-1.3.1/datatables.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
-->



<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<link rel="stylesheet" data-id="3" type="text/css" href="https://cdn.datatables.net/v/bs4/jqc-1.12.4/jszip-2.5.0/dt-1.10.20/b-1.6.1/b-colvis-1.6.1/b-flash-1.6.1/b-html5-1.6.1/b-print-1.6.1/cr-1.5.2/fh-3.1.6/r-2.2.3/rr-1.2.6/sl-1.3.1/datatables.min.css"/> 
<script type="text/javascript" data-id="6" src="https://cdn.datatables.net/v/bs4/jqc-1.12.4/jszip-2.5.0/dt-1.10.20/b-1.6.1/b-colvis-1.6.1/b-flash-1.6.1/b-html5-1.6.1/b-print-1.6.1/cr-1.5.2/fh-3.1.6/r-2.2.3/rr-1.2.6/sl-1.3.1/datatables.min.js"></script>
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.6/umd/popper.min.js"></script>
 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js"></script>

<!--
<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
-->

<style>
.popover{
    max-width: 100%; /* Max Width of the popover (depending on the container!) */
	 white-space: pre-wrap;  /* To preserve spaces */
	 height: 300px;
    overflow-y: auto;
}
.label-warning{
	
	background-color:#ff4d4d
}
td.highlight {
       text-align:center;
        background-color: white;
		
    }

	.footer{
		position:fixed;
		left:0;
		bottom:0;
		width: 100%;
		background-color: #302f2f;
		color:white;
		text-align: right;
	}
progress[value]  {
  -webkit-appearance: none;
     -moz-appearance: none;
          appearance: none;
  border: none;
  width: 100%;
  height: 20px;
  color: green; 
   border-radius: 9px;
   content: attr('80%');
}


</style>
</head>

<body>

<div class="container">
	<progress style="display:none" max="100" value="0" id="myBar" data-label="50%"></progress>
	<div class="progress">
		<div id="myBar2" class="progress-bar bg-danger progress-bar-striped progress-bar-animated" style="width:0%">
			0% 
		</div>
	</div>

	<div class="row">
		<div class="col-sm">
			<div id="fakeProgress" style="display:none">
				<span class="badge badge-pill badge-danger"> <span id="emailsCountStartDisplay" class="badge badge-light">0</span></span><progress></progress><span class="badge badge-pill badge-danger"> <span id="emailsCountDisplay" class="badge badge-light">0</span> Emails</span>
			</div>
		</div>
		
		<div class="col-sm">
			<span class="badge badge-pill badge-danger" style="width:100%;display:none" id="resultOfManipulation"> ???</span>
		</div>
	</div>

</div>
<br>

</div>
		<div class="container">
		  <div class="row">
			<div class="col-sm">
				 <div class="card border-dark mb-3" >
					<div class="card-header text-center">ABEND</div>
					  <div class="card-body text-primary">
							<div class="col-sm text-center">
								 <span class="badge badge-pill badge-primary">Notify <span id="notifyDisplay" class="badge badge-dark" >0</span></span>
								 <span class="badge badge-pill badge-primary">RR <span id="rerunDisplay" class="badge badge-dark">0</span></span>
								 <span class="badge badge-pill badge-primary">RR ps25 <span id="rrPsDisplay" class="badge badge-dark">0</span></span>
								 <span class="badge badge-pill badge-primary">MC <span id="mcDisplay" class="badge badge-dark">0</span></span>
								 <span class="badge badge-pill badge-primary">MC ps25 <span id="mcPsDisplay" class="badge badge-dark">0</span></span>
								 <div style="display:none" id="abendUndefinedDisplayDiv"><span  class="badge badge-pill badge-danger">Undefined <span id="abendUndefinedDisplay" class="badge badge-dark">0</span></span></div>
							</div>
					  </div>
				</div>
			</div>
			<div class="col-sm">
				 <div class="card border-dark mb-3">
					  <div class="card-header text-center">NON-ABEND</div>
					  <div class="card-body text-primary">
							<div class="col-sm text-center">
								<span class="badge badge-pill badge-primary">Long Running <span id="longRunDisplay" class="badge badge-dark">0</span></span>
								<span class="badge badge-pill badge-primary">Due-out <span id="dueOutDisplay" class="badge badge-dark">0</span></span>
								<span class="badge badge-pill badge-primary">Stuck <span id="stuckDisplay" class="badge badge-dark">0</span></span>
								<span class="badge badge-pill badge-primary">PCN <span id="pcnDisplay" class="badge badge-dark">0</span></span>
								<span class="badge badge-pill badge-primary">Capping <span id="cappingDisplay" class="badge badge-dark">0</span></span>
								<span class="badge badge-pill badge-primary">Hold & Release <span id="holdReleaseDisplay" class="badge badge-dark">0</span></span>
								<span class="badge badge-pill badge-primary">Cancelling <span id="cancellingDisplay"class="badge badge-dark">0</span></span>
								<span class="badge badge-pill badge-primary">Force <span id="forceDisplay" class="badge badge-dark">0</span></span>
								<span class="badge badge-pill badge-primary">Insert <span id="insertDisplay" class="badge badge-dark">0</span></span>
								<span class="badge badge-pill badge-primary">Tpipe <span id="tpipeDisplay" class="badge badge-dark">0</span></span>
								<span class="badge badge-pill badge-primary">CleanUp <span id="cleanUpDisplay" class="badge badge-dark">0</span></span>
								<span class="badge badge-pill badge-primary">Turnover <span id="turnoverDisplay" class="badge badge-dark">0</span></span>
								<div style="display:none" id="nonAbendUndefinedDisplayDiv"><span  class="badge badge-pill badge-danger">Undefined <span id="nonAbendUndefinedDisplay" class="badge badge-dark">0</span></span></div>
							</div>
					  </div>
				  </div>
			 </div>
	
		  </div>
		</div><br><br>
	<div class="container">
		<div class="row">
			<div class="col-sm">
				<table class="table table-sm table-bordered" id="abendsTable"">
					<thead class="thead-light">
						<th class="text-center" style="color:black;">Jobname</th>
						<th class="text-center" style="color:black;">Site</th>
						<th class="text-center" style="color:black;">Date</th>
						<th class="text-center" style="color:black;">Time</th>
						<th class="text-center" style="width:25%;color:black" >Action</th>
						<th class="text-center" style="color:black;">Time of action</th>
						<th class="text-center" style="color:red">DebugMe</th>
					</thead>
					<tbody id="abendsTbody">
					<tbody>
				</table>
			</div>
		</div>
	</div>
		<br>
	<div class="container">
		<div class="row">
			<div class="col-sm">
				<table class="table table-sm table-bordered" id="longRunningTable">
					<thead class="thead-light">
						<th class="text-center" style="color:black;">Jobname</th>
						<th class="text-center" style="color:black;">Date</th>
						<th class="text-center" style="color:black;">Time</th>
						<th class="text-center" style="width:25%;color:black">Action</th>
						<th class="text-center" style="color:black;">Team</th>
						<th class="text-center" style="color:black;">Time of action</th>
						<th class="text-center" style="color:red;">DebugMe</th>
					</thead>
					<tbody id="longRunningTbody" >
					<tbody>
				</table>
			</div>
		</div>
	</div>
		<br><br>
		
	<div class="container">
		<div class="row">
			<div class="col-sm">
			
			<div class="input-group input-group-lg">
			  <div class="input-group-prepend">
				<span class="input-group-text" >Folder Name</span>
			  </div>
			  <input type="text" value="tempNovember" id="folderName" class="form-control">
			   <div class="input-group-append">
				<button class="btn btn-success" type="button" onclick="inputValidation()"> CREATE LOGS</button>
				<!--<button id="showDebugButton" style="display:none" class="btn btn-danger" type="button" data-status="hidden" onclick="showDebug(this)"> HIDE DEBUG</button> -->
				<!--<button class="btn btn-success" id="btnExportAbends" style="display:none" onclick="exportLogs('abends');"> EXPORT ABENDS </button> -->
				<!--<button class="btn btn-success" id="btnExportNonAbends" style="display:none" onclick="exportLogs('nonAbends');"> EXPORT NON-ABENDS </button> -->
				 
			  </div>
			</div>
			<!-- To be continued:)  
			<div class="input-group input-group-lg">
			  <div class="input-group-prepend">
				<span class="input-group-text" >Select Month and Year (to be continued)</span>
			  </div>
				 <div class="dropdown">
				  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMonth" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Month
				  </button>
				  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
					<a class="dropdown-item" href="#">October</a>
					<a class="dropdown-item" href="#">November</a>
					<a class="dropdown-item" href="#">December</a>
				  </div>
				</div>				
				<div class="dropdown">
				  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownYear" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Year
				  </button>
				  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
					<a class="dropdown-item" href="#">2019</a>
					<a class="dropdown-item" href="#">2020</a>
				  </div>
				</div>
			</div>	
			-->
			<div class="input-group input-group-lg">
			  <div class="input-group-prepend">
				<span class="input-group-text" >Signature</span>
			  </div>
			  <input type="text" value="Jake James Manzon" id="signatureName" class="form-control">
			</div>			
			
			<div class="input-group" >
			  <div class="input-group-prepend">
				<span class="input-group-text" >Abend-Notify-Keywords and minutes</span>
			  </div>

				<input type="text" value="advise;WAITING T/S INIT;check and advise;Updating abends;Updating" id="abendNotifyKeywords" class="form-control">
				<!--<input type="number" id="rerunMinute" min="1" value="3" class="form-control">-->

			</div>			
			
			<div class="input-group">
			  <div class="input-group-prepend">
				<span class="input-group-text" >RR-Keywords: and minutes</span>
			  </div>
			  <input type="text" value="RECOVERY FAILED;been rerun" id="rerunKeywords" class="form-control">
			  <!--<input type="number" id="notifyMinute" min="1" value="3" class="form-control">-->
			</div>			
			
			<div class="input-group">
			  <div class="input-group-prepend">
				<span class="input-group-text" >MC-Keywords and minutes</span>
			  </div>
			  <input type="text" value="NO RECOVERY REQUIRED;marked complete;marked as complete" id="mcKeywords" class="form-control">
			  <!--<input type="number" id="mcMinute" min="1" value="2" class="form-control">-->
			</div>			
			
			<div class="input-group">
			  <div class="input-group-prepend">
				<span class="input-group-text" >LongRunning-Keywords and minutes</span>
			  </div>
			  <input type="text" value="running" id="longRunningKeywords" class="form-control">
			  <!--<input type="number" id="longRunningMinute" min="1" value="4" class="form-control">-->
			</div>			
			
			<div class="input-group">
			  <div class="input-group-prepend">
				<span class="input-group-text" >Hold & Release-Keywords and minutes</span>
			  </div>
									<!-- HELD    -   NEW  ST;RELEASED - NEW ST -->
			  <input type="text" value="HELD;RELEASED" id="holdReleaseKeywords" class="form-control">
			   <!--<input type="number" id="holdReleaseMinute" min="1" value="2" class="form-control">-->
			</div>			
			
			<div class="input-group">
			  <div class="input-group-prepend">
				<span class="input-group-text" >Missed-Dueout-Keywords and minutes</span>
			  </div>
			  <input type="text" value="missed;LATE" id="missedDueOutKeywords" class="form-control">
			  <!--  <input type="number" id="missedDueOutMinute" min="1" value="3" class="form-control">-->
			</div>			
			
			<div class="input-group">
			  <div class="input-group-prepend">
				<span class="input-group-text" >Capping-Keywords and minutes</span>
			  </div>
			  <input type="text" value="capping;quick view" id="cappingKeywords" class="form-control">
			  <!--  <input type="number" id="cappingMinute" min="1" value="3" class="form-control">-->
			</div>			
			
			<div class="input-group">
			  <div class="input-group-prepend">
				<span class="input-group-text" >Tpipe-Keywords and minutes</span>
			  </div>
			  <input type="text" value="TPIPE;L$" id="tpipeKeywords" class="form-control">
			   <!-- <input type="number" id="tpipeMinute" min="1" value="3" class="form-control">-->
			</div>			
			
			<div class="input-group">
			  <div class="input-group-prepend">
				<span class="input-group-text" >Stuck-Keywords and minutes</span>
			  </div>
			  <input type="text" value="stuck in submit" id="stuckKeywords" class="form-control">
			  <!--  <input type="number" id="stuckMinute" min="1" value="3" class="form-control">-->
			</div>			
			
			<div class="input-group">
			  <div class="input-group-prepend">
				<span class="input-group-text" >CleanUp-Keywords and minutes</span>
			  </div>
			  <input type="text" value="clear off;clean job" id="cleanUpKeywords" class="form-control">
			  <!--  <input disabled type="number" id="stuckMinute" min="1" value="0" class="form-control">-->
			</div>			
			
			<div class="input-group">
			  <div class="input-group-prepend">
				<span class="input-group-text" >Force-Keywords and minutes</span>
			  </div>
			  <input type="text" value="force;force release" id="forceKeywords" class="form-control">
			  <!--  <input type="number" id="forceMinute" min="1" value="3" class="form-control"> -->
			</div>			

			<div class="input-group">
			  <div class="input-group-prepend">
				<span class="input-group-text" >Insert-Keywords and minutes</span>
			  </div>
			  <input type="text" value="inserted;ADDED BY RUSH;HAS BEEN ADDED TO THE SCHEDULE" id="insertKeywords" class="form-control">
			 <!-- <input type="number" id="insertMinute" min="1" value="3" class="form-control">-->
			</div>			
			
			<div class="input-group">
			  <div class="input-group-prepend">
				<span class="input-group-text" >Cancelled-Keywords and minutes</span>
			  </div>
			  <input type="text" value="cancelled" id="cancelledKeywords" class="form-control">
			  <!--<input type="number" min="1" value="3" id="cancelMinute" class="form-control">-->
			</div> 			
			
			<div class="input-group">
			  <div class="input-group-prepend">
				<span class="input-group-text" >PCN-Keywords and minutes</span>
			  </div>
			  <input type="text" value="signed off" id="pcnKeywords" class="form-control">
			 <!-- <input type="number" min="1" value="3" id="pcnMinute" class="form-control"> -->
			</div> 
			
			
			</div>
		</div>
		<br>
		
	</div>
		
		<iframe id="txtArea1" style="display:none"></iframe>

		<div >
			Reminder: <br>
			*Folder Name, Signature and keywords are case sensitive.<br>
			*For Zjob/s to be called Mark as Complete as per ps25/ps22, pd34 or MARS record of Zjob must be included (NO RECOVERY REQUIRED). <br>
			*For Zjob/s to be called RR as per ps25, pd34 or MARS record of Zjob must be included (RECOVERY FAILED). So thus RR as per programmer (RECOVERY ACTIVE). <br>
			--add reminder--
		</div>

	<br><br><br>
		<div class="footer">
			<p style="color:white">Nov 25th 2019 - Made by Duke and Jake :)	</p>
		</div>
		<script>

		</script>
</body>
<script>

	function removeRow(button){
		//alert("working..")
		if(button.getAttribute("data-status") == "enabled"){
			button.parentNode.parentNode.classList.remove("label-warning");
			//button.parentNode.parentNode.setAttribute(
			setMultipleAttributes(button,{"class":"btn btn-danger btn-xs","data-status":"disabled"});
			button.innerHTML = "REMOVE";	
			if(button.getAttribute("data-table") == "abendTable"){
				abendUndefinedCount--;
				if(abendUndefinedCount == 0){
					document.getElementById("abendUndefinedDisplayDiv").style.display = "none";
				}
					document.getElementById("abendUndefinedDisplay").textContent = abendUndefinedCount;
			}else{
				nonAbendUndefinedCount--;
				if(nonAbendUndefinedCount == 0){
					document.getElementById("nonAbendUndefinedDisplayDiv").style.display = "none";
				}
					document.getElementById("nonAbendUndefinedDisplay").textContent = nonAbendUndefinedCount;
			}
		}else{
			button.parentNode.parentNode.classList.add("label-warning");
			//button.parentNode.parentNode.setAttribute(
			setMultipleAttributes(button,{"class":"btn btn-success btn-xs","data-status":"enabled"});
			button.innerHTML = "ADD";		
			if(button.getAttribute("data-table") == "abendTable"){
				abendUndefinedCount++;
				if(abendUndefinedCount > 0){
					document.getElementById("abendUndefinedDisplayDiv").style.display = "block";
				}
					document.getElementById("abendUndefinedDisplay").textContent = abendUndefinedCount;
			}else{
				nonAbendUndefinedCount++;
				if(nonAbendUndefinedCount > 0){
					document.getElementById("nonAbendUndefinedDisplayDiv").style.display = "block";
				}
					document.getElementById("nonAbendUndefinedDisplay").textContent = nonAbendUndefinedCount;
			}
					
		}
	}
	
	function setMultipleAttributes(el, attrs) {
		for(var key in attrs) {
			el.setAttribute(key, attrs[key]);
		}
	}
		
		$(document).ready(function() {
			//$('[data-toggle="popover"]').popover(); // enable all popovers
		
			$('[data-toggle="popover"]').popover({
				html : true,
				container: 'html',
				// trigger: 'focus'
			})    
	
			var t1 = $('#abendsTable').DataTable({
				destroy: true,
				 dom: 'Bfrtip',
				 "paging": false,
				 "scrollY": "250px",
				 "scrollCollapse": true,
				buttons: [
					{
						extend: 'copyHtml5',
						exportOptions: {
							columns: [ 0, ':visible' ]
						}
					},
					{
						title: document.getElementById("signatureName").value.split(" ")[0] +' Abends logs',
						extend: 'excelHtml5',
						exportOptions: {
							columns: [ 0, 1, 2, 3,4,5 ],
							rows: ':not(.label-warning)', 
						}
					},
					{
						title: document.getElementById("signatureName").value.split(" ")[0] +' Abends logs',
						extend: 'pdfHtml5',
						exportOptions: {
							columns: [ 0, 1, 2, 3,4,5 ]
						}
					},
					'colvis'
				],
				 responsive: true,
				 colReorder: true,
				 "order": [[ 2, 'asc' ], [ 5, 'asc' ]], 
				 "createdRow": function ( row, data, index ) {
					if ( data[0] == "Undefined" || data[1] == "Undefined" ) {
						$('td', row).eq(6).addClass('highlight');
						$(row).addClass('label-warning');
						row.childNodes[6].innerHTML = "<button onclick='removeRow(this)' data-status='enabled' type='button' data-table='abendTable' class='btn btn-success btn-xs'>ADD</button>"
						
						abendUndefinedCount++;
						document.getElementById("abendUndefinedDisplayDiv").style.display = "block";
						document.getElementById("abendUndefinedDisplay").textContent = abendUndefinedCount;
					}
				}
				 
			});	
			
			$('#abendsTable').on('click', 'tbody tr td', function() {
				var email = this.getAttribute('data-email')
				var temp = emailsGlobalVar.Item(email).Body;
				//console.log( typeof(temp))
				var info = "Sent:"+ new Date(emailsGlobalVar.Item(email).SentOn)+ "\n To: " + emailsGlobalVar.Item(email).to + "\n Cc: " + emailsGlobalVar.Item(email).cc + "\n Subject: " +emailsGlobalVar.Item(email).ConversationTopic;
				this.setAttribute("title",info);
				this.setAttribute("data-content",temp);
				//$('[data-toggle="popover"]').popover('hide');
				$(this).popover('show');
					//calculate Time column
					//var previousSent = temp.slice(temp.split("Sent:", 1).join("Sent:").length,temp.split("Sent:", 1).join("Sent:").length+50);
					//var previousTime = previousSent.slice( previousSent.split(":", 2).join(":").length-2,previousSent.split(":", 2).join(":").length+7).trim();
					//console.log(previousTime)
			})

			var t2 = $('#longRunningTable').DataTable({
				destroy: true,
				 dom: 'Bfrtip',
				 "paging": false,
				 "scrollY": "250px",
				  "scrollCollapse": true,
				buttons: [
					{
						extend: 'copyHtml5',
						exportOptions: {
							columns: [ 0, ':visible' ]
						}
					},
					{
						title: document.getElementById("signatureName").value.split(" ")[0] +' Non-abends logs',
						extend: 'excelHtml5',
						exportOptions: {
							columns: [ 0, 1, 2, 3,4,5 ],
							rows: ':not(.label-warning)', 
						}
					},
					{
						title: document.getElementById("signatureName").value.split(" ")[0] + ' Non-abends logs',
						extend: 'pdfHtml5',
						exportOptions: {
							columns: [ 0, 1, 2, 3,4,5 ]
						}
					},
					'colvis'
				],
				responsive: true,
				colReorder: true,
				"order": [[ 1, 'asc' ], [ 5, 'asc' ]],
				"createdRow": function ( row, data, index,cells ) {
					if ( data[0] == "Undefined" || data[4] == "Undefined" ) {
						$('td', row).eq(6).addClass('highlight');
						$(row).addClass('label-warning');
						row.childNodes[6].innerHTML = "<button onclick='removeRow(this)' data-status='enabled' data-table='nonAbendTable' type='button' class='btn btn-success btn-xs'>ADD</button>"
						//row.childNodes[6].innerHTML = "<input type='checkbox' data-toggle='toggle' data-on='Enabled' data-off='Disabled'>"
						
						nonAbendUndefinedCount++;
						document.getElementById("nonAbendUndefinedDisplayDiv").style.display = "block";
						document.getElementById("nonAbendUndefinedDisplay").textContent = nonAbendUndefinedCount;
					}
				}
			});
			
			$('#longRunningTable').on('click', 'tbody tr td', function() {
			 var email = this.getAttribute('data-email')
				var temp = emailsGlobalVar.Item(email).Body;
				var info = "Sent:"+ new Date(emailsGlobalVar.Item(email).SentOn)+ "\n To: " + emailsGlobalVar.Item(email).to + "\n Cc: " + emailsGlobalVar.Item(email).cc + "\n Subject: " +emailsGlobalVar.Item(email).ConversationTopic;
				this.setAttribute("title",info);
				this.setAttribute("data-content",temp);
				//$('[data-toggle="popover"]').popover('hide');
				$(this).popover('show');
			})
			
			$('#showDebugButton').on( 'click', function (e) {
				e.preventDefault();
				//hide column
				var column = t2.column( 6 );
				column.visible( ! column.visible() );
				

			} );

		} );

		var rerunMinute = 0; 
		var notifyMinute = 0; 
		var markCompleteMinute = 0; 
		var longRunningMinute = 0;
		var holdReleaseMinute = 0;
		var missedDueOutMinute = 0;
		var cappingMinute = 0;
		var tpipeMinute = 0;
		var stuckMinute = 0;
		var forceMinute = 0;
		var insertMinute = 0;
		var cancelMinute = 0;
		var pcnMinute = 0;
		
		var abendCount = 0;
		var rrCount = 0;
		var rrPsCount = 0;
		var mcCount = 0;
		var mcPsCount = 0;
		var longRunCount = 0;
		var holdReleaseCount = 0;
		var dueOutCount = 0;
		var cappingCount = 0;
		var tpipeCount = 0;
		var stuckCount = 0;
		var cleanUpCount = 0;
		var forceCount = 0;
		var insertCount = 0;
		var cancelledCount = 0;
		var turnOverCount = 0;
		var pcnCount = 0;
		var abendUndefinedCount = 0;
		var nonAbendUndefinedCount = 0;
		
		
	function exportLogs(name){
	var table;
	name =='abends' ? table = document.getElementById('abendsTable') : table = document.getElementById('longRunningTable')
    var tab_text="<table border='2px'><tr bgcolor='grey' color='white'>";
    var textRange; var j=0;
    //tab = document.getElementById('longRunningTable'); // id of table
	var latestRow = 1;
    for(j = 0 ; j < table.rows.length ; j++) {     
		if(j>=1 && table.rows[j].cells.length > 4){
			if( name == "abends"){
				//var cellText = document.createTextNode( "=IF(D"+(latestRow+1)+"=\"\",\"-\",F"+(latestRow+1)+"-D"+(latestRow+1)+")" );
					//table.rows[j].insertCell(-1).appendChild(cellText);
			}else{
				//var cellText = document.createTextNode( "=IF(C"+(latestRow+1)+"=\"\",\"-\",F"+(latestRow+1)+"-C"+(latestRow+1)+")" );
				//table.rows[j].insertCell(-1).appendChild(cellText);			
			}
			
			latestRow++;
			//tab_text = tab_text + (table.rows[j].cells[0] + table.rows[j].cells[1] + table.rows[j].cells[2] + table.rows[j].cells[3] + table.rows[j].cells[4] + table.rows[j].cells[5]) + "</tr>";
			//console.log(table.rows[j].cells.item(3).innerHTML )
		 }	
        tab_text = tab_text + table.rows[j].innerHTML + "</tr>";
		//console.log(table.rows[j].innerHTML )
		//tab_text=tab_text+"</tr>";
    }

    tab_text=tab_text+"</table>";
    tab_text= tab_text.replace(/<A[^>]*>|<\/A>/g, "");//remove if u want links in your table
    tab_text= tab_text.replace(/<img[^>]*>/gi,""); // remove if u want images in your table
    tab_text= tab_text.replace(/<input[^>]*>|<\/input>/gi, ""); // reomves input params

    var ua = window.navigator.userAgent;
    var msie = ua.indexOf("MSIE "); 

    if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))      // If Internet Explorer
    {
        txtArea1.document.open("xls","replace");
        txtArea1.document.write(tab_text);
        txtArea1.document.close();
        txtArea1.focus(); 
        //sa=txtArea1.document.execCommand("SaveAs",true,"My MONTH logs.xls");
		var user = document.getElementById("signatureName").value.split(" ")[0]
		name =='abends' ? sa=txtArea1.document.execCommand("SaveAs",true,user+"'s Abends logs.xls") : sa=txtArea1.document.execCommand("SaveAs",true,user+"'s Non-Abends logs.xls")
    }  
    else                 //other browser not tested on IE 11
        sa = window.open('data:application/vnd.ms-excel,' + encodeURIComponent(tab_text));  
	
    return (sa);
}
		
		var abendsDebugColumn = [];
		var nonAbendsDebugColumn = [];

		
		function resetCounter(){
			 abendCount = 0;
			 rrCount = 0;
			 rrPsCount = 0;
			 mcCount = 0;
			 mcPsCount = 0;
			 longRunCount = 0;
			 holdReleaseCount = 0;
			 dueOutCount = 0;
			 cappingCount = 0;
			 tpipeCount = 0;
			 stuckCount = 0;
			 cleanUpCount = 0;
			 forceCount = 0;
			 insertCount = 0;
			 cancelledCount = 0;
			 turnOverCount = 0;
			 pcnCount = 0;
		}
		
		function createSummary(action){
			switch( action ){
				case "mark complete as per ps25":
					mcPsCount++;
					document.getElementById("mcPsDisplay").textContent = mcPsCount;
					break;
				case "mark complete as per programmer":
					mcCount++;
					document.getElementById("mcDisplay").textContent = mcCount;
					break;
				case "notify programmer":
					abendCount++;
					document.getElementById("notifyDisplay").textContent = abendCount;
					break;
				case "rerun as per PS25":
					rrPsCount++;
					document.getElementById("rrPsDisplay").textContent = rrPsCount;
					break;
				case "rerun as per programmer":
					rrCount++;
					document.getElementById("rerunDisplay").textContent = rrCount;
					break;
				case "Missed Due Out":
					dueOutCount++;
					document.getElementById("dueOutDisplay").textContent = dueOutCount;
					break;
				case "long running":
					longRunCount++;
					document.getElementById("longRunDisplay").textContent = longRunCount;
					break;					
				case "Stuck in Submit":
					stuckCount++;
					document.getElementById("stuckDisplay").textContent = stuckCount;
					break;
				case "PCN":
					pcnCount++;
					document.getElementById("pcnDisplay").textContent = pcnCount;
					break;
				case "Capping":
					cappingCount++;
					document.getElementById("cappingDisplay").textContent = cappingCount;
					break;					
				case "Hold and Release of jobs":
					holdReleaseCount++;
					document.getElementById("holdReleaseDisplay").textContent = holdReleaseCount;
					break;
				case "Cancelling of jobs":
					cancelledCount++;
					document.getElementById("cancellingDisplay").textContent = cancelledCount;
					break;
				case "Force running":
					forceCount++;
					document.getElementById("forceDisplay").textContent = forceCount;
					break;				
				case "Inserting of jobs":
					insertCount++;
					document.getElementById("insertDisplay").textContent = insertCount;
					break;
				case "Tpipe":
					tpipeCount++;
					document.getElementById("tpipeDisplay").textContent = tpipeCount;
					break;
				case "PPC05 CLEAN UP":
					cleanUpCount++;
					document.getElementById("cleanUpDisplay").textContent = cleanUpCount;
					break;					
				case "DTS Shift Turnover (turnover)":
					turnOverCount++;
					document.getElementById("turnoverDisplay").textContent = turnOverCount;
					break;
				default:
					
			}
		
		}
		
		function inputValidation(){
			document.getElementById("abendsTbody").innerHTML = "";
			document.getElementById("longRunningTbody").innerHTML = "";
			//document.getElementById("showDebugButton").style.display = "none";
			//document.getElementById("showDebugButton").setAttribute("class","btn btn-danger")
			//document.getElementById("showDebugButton").innerHTML = "HIDE DEBUG"
			
			document.getElementById("mcPsDisplay").textContent = mcPsCount;
			document.getElementById("mcDisplay").textContent = mcCount;
			document.getElementById("notifyDisplay").textContent = abendCount;
			document.getElementById("rrPsDisplay").textContent = rrPsCount;
			document.getElementById("rerunDisplay").textContent = rrCount;
			document.getElementById("dueOutDisplay").textContent = dueOutCount;
			document.getElementById("longRunDisplay").textContent = longRunCount;
			document.getElementById("stuckDisplay").textContent = stuckCount;
			document.getElementById("pcnDisplay").textContent = pcnCount;
			document.getElementById("cappingDisplay").textContent = cappingCount;
			document.getElementById("holdReleaseDisplay").textContent = holdReleaseCount;
			document.getElementById("cancellingDisplay").textContent = cancelledCount;
			document.getElementById("forceDisplay").textContent = forceCount;
			document.getElementById("tpipeDisplay").textContent = tpipeCount;
			document.getElementById("cleanUpDisplay").textContent = cleanUpCount;
			document.getElementById("turnoverDisplay").textContent = turnOverCount;
			document.getElementById("insertDisplay").textContent = insertCount;
				
			var folderName = document.getElementById("folderName").value;
			var signatureName = document.getElementById("signatureName").value;
			var abendNotifyKeywords = document.getElementById("abendNotifyKeywords").value;
			var rerunKeywords = document.getElementById("rerunKeywords").value;
			var mcKeywords = document.getElementById("mcKeywords").value;
			var longRunningKeywords = document.getElementById("longRunningKeywords").value;
			var holdReleaseKeywords = document.getElementById("holdReleaseKeywords").value;
			var missedDueOutKeywords = document.getElementById("missedDueOutKeywords").value;
			var cappingKeywords = document.getElementById("cappingKeywords").value;
			var tpipeKeywords = document.getElementById("tpipeKeywords").value;
			var stuckKeywords = document.getElementById("stuckKeywords").value;
			var cleanUpKeywords = document.getElementById("cleanUpKeywords").value;
			var forceKeywords = document.getElementById("forceKeywords").value;
			var cancelledKeywords = document.getElementById("cancelledKeywords").value;
			var insertKeywords = document.getElementById("insertKeywords").value;
			var pcnKeywords = document.getElementById("pcnKeywords").value;
				//folderName=='' ? folderName = 'tempNovember' : ''
				//signatureName=='' ? signatureName = 'Jake James Manzon' : ''
				//abendNotifyKeywords=='' ? abendNotifyKeywords = 'advise;WAITING T/S INIT;check and advise;Updating abends;Updating' : ''
				//rerunKeywords=='' ? rerunKeywords = 'been rerun;RECOVERY FAILED' : ''
				//mcKeywords=='' ? mcKeywords = 'NO RECOVERY REQUIRED;marked' : ''
				//longRunningKeywords=='' ? longRunningKeywords = 'running' : ''
				//holdReleaseKeywords=='' ? holdReleaseKeywords = 'HELD;RELEASED' : ''
				//missedDueOutKeywords=='' ? missedDueOutKeywords = 'missed;LATE' : ''
				//cappingKeywords=='' ? cappingKeywords = 'capping;quick view' : ''
				//tpipeKeywords=='' ? tpipeKeywords = 'TPIPE;L$' : ''
				//stuckKeywords=='' ? stuckKeywords = 'stuck in submit' : ''
				//cleanUpKeywords=='' ? cleanUpKeywords = 'clear off;clean job' : ''
				//forceKeywords=='' ? forceKeywords = 'force started;force release' : ''
				//cancelledKeywords=='' ? cancelledKeywords = 'cancelled' : ''
				//insertKeywords=='' ? insertKeywords = 'inserted;ADDED BY RUSH' : ''
				//pcnKeywords=='' ? pcnKeywords = 'signed off' : ''
				
		/**	var tempNotifyMinute = document.getElementById("notifyMinute").value;
			var tempRerunMinute = document.getElementById("rerunMinute").value;
			var tempMcMinute = document.getElementById("mcMinute").value;
			var tempLongRunningMinute = document.getElementById("longRunningMinute").value;
			var tempHoldReleaseMinute = document.getElementById("holdReleaseMinute").value;
			var tempMissedDueOutMinute = document.getElementById("missedDueOutMinute").value;
			var tempCappingMinute = document.getElementById("cappingMinute").value;
			var tempTpipeMinuteMinute = document.getElementById("tpipeMinute").value;
			var tempStuckMinuteMinute = document.getElementById("stuckMinute").value;
			var tempForceMinute = document.getElementById("forceMinute").value;
			var tempInsertMinute = document.getElementById("insertMinute").value;
			var tempCancelMinute = document.getElementById("cancelMinute").value;
			var tempPcnMinute = document.getElementById("pcnMinute").value;
				tempNotifyMinute=='' ? notifyMinute = 0 : notifyMinute=tempNotifyMinute;
				tempRerunMinute=='' ? rerunMinute = 0 : rerunMinute=tempRerunMinute;
				tempMcMinute=='' ? markCompleteMinute = 0 : markCompleteMinute=tempMcMinute;
				tempLongRunningMinute=='' ? longRunningMinute = 0 : longRunningMinute=tempLongRunningMinute;
				tempHoldReleaseMinute=='' ? holdReleaseMinute = 0 : holdReleaseMinute=tempHoldReleaseMinute;
				tempMissedDueOutMinute=='' ? missedDueOutMinute = 0 : missedDueOutMinute=tempMissedDueOutMinute;
				tempCappingMinute=='' ? cappingMinute = 0 : cappingMinute=tempCappingMinute;
				tempTpipeMinuteMinute=='' ? tpipeMinute = 0 : tpipeMinute=tempTpipeMinuteMinute;
				tempStuckMinuteMinute=='' ? stuckMinute = 0 : stuckMinute=tempStuckMinuteMinute;
				tempForceMinute=='' ? forceMinute = 0 : forceMinute=tempForceMinute;
				tempInsertMinute=='' ? insertMinute = 0 : insertMinute=tempInsertMinute;
				tempCancelMinute=='' ? cancelMinute = 0 : cancelMinute=tempCancelMinute;
				tempPcnMinute=='' ? pcnMinute = 0 : pcnMinute=tempPcnMinute;
		*/	
				
				
			//(str.search(/\bWidget\b/) >= 0)
			//myBody.indexOf("advise")>0 ||myBody.indexOf("check and advise")>0 || myBody.indexOf("Updating abends")>0 || (myBody.indexOf("check")>0 && myBody.indexOf("WAITING T/S")>0 )|| myBody.indexOf("Updating")>0
			var newAbendNotifyKeywordsExpression ="";
			for( var a=0; a < abendNotifyKeywords.split(";").length; a++ ){
				newAbendNotifyKeywordsExpression += "myBody.indexOf('"+ abendNotifyKeywords.split(";")[a]+"')>0";
				a != abendNotifyKeywords.split(";").length-1 ? newAbendNotifyKeywordsExpression += " || " : "";
			}
			//(str.search(/\bWidget\b/) >= 0)
			var newRerunKeywordsExpression ="";
			for( var r=0; r < rerunKeywords.split(";").length; r++ ){
				newRerunKeywordsExpression += "myBody.indexOf('"+ rerunKeywords.split(";")[r]+"')>0";
				r != rerunKeywords.split(";").length-1 ? newRerunKeywordsExpression += " || " : "";
			}			
			//(str.search(/\bWidget\b/) >= 0)
			var newMcKeywordsExpression ="";
			for( var m=0; m < mcKeywords.split(";").length; m++ ){
				newMcKeywordsExpression += "myBody.indexOf('"+ mcKeywords.split(";")[m]+"')>0";
				m != mcKeywords.split(";").length-1 ? newMcKeywordsExpression += " || " : "";
			}			
			//(str.search(/\bWidget\b/) >= 0)
			var newLongRunningKeywordsExpression ="";
			for( var l=0; l < longRunningKeywords.split(";").length; l++ ){
				newLongRunningKeywordsExpression += "myBody.indexOf('"+ longRunningKeywords.split(";")[l]+"')>0";
				l != longRunningKeywords.split(";").length-1 ? newLongRunningKeywordsExpression += " || " : "";
			}	
				console.log("newLR: "+newLongRunningKeywordsExpression)
			//(str.search(/\bWidget\b/) >= 0)
			var newHoldReleaseKeywordsExpression ="";
			for( var h=0; h < holdReleaseKeywords.split(";").length; h++ ){
				newHoldReleaseKeywordsExpression += "myBody.indexOf('"+ holdReleaseKeywords.split(";")[h]+"')>0";
				h != holdReleaseKeywords.split(";").length-1 ? newHoldReleaseKeywordsExpression += " || " : "";
			}			
			/* search for specific keywords
				let str = "Widget";
				if (str.search(/\bWidget\b/) >= 0) {
				console.log( 'Found it!' );
				}
			*/
			var newMissedDueOutKeywordsExpression ="";
			for( var d=0; d < missedDueOutKeywords.split(";").length; d++ ){
				newMissedDueOutKeywordsExpression += "myBody.indexOf('"+ missedDueOutKeywords.split(";")[d]+"')>0";
				d != missedDueOutKeywords.split(";").length-1 ? newMissedDueOutKeywordsExpression += " || " : "";
			}			
			//(str.search(/\bWidget\b/) >= 0)
			var newCappingKeywordsExpression ="";
			for( var c=0; c < cappingKeywords.split(";").length; c++ ){
				newCappingKeywordsExpression += "myBody.indexOf('"+ cappingKeywords.split(";")[c]+"')>0";
				c != cappingKeywords.split(";").length-1 ? newCappingKeywordsExpression += " || " : "";
			}			
			//(str.search(/\bWidget\b/) >= 0)			
			var newTpipeKeywordsExpression ="";
			for( var t=0; t < tpipeKeywords.split(";").length; t++ ){
				newTpipeKeywordsExpression += "myBody.indexOf('"+ tpipeKeywords.split(";")[t]+"')>0";
				t != tpipeKeywords.split(";").length-1 ? newTpipeKeywordsExpression += " || " : "";
			}			
			//(str.search(/\bWidget\b/) >= 0)			
			var newStuckKeywordsExpression ="";
			for( var s=0; s < stuckKeywords.split(";").length; s++ ){
				newStuckKeywordsExpression += "myBody.indexOf('"+ stuckKeywords.split(";")[s]+"')>0";
				s != stuckKeywords.split(";").length-1 ? newStuckKeywordsExpression += " || " : "";
			}			
			//(str.search(/\bWidget\b/) >= 0)			
			var newCleanUpKeywordsExpression ="";
			for( var u=0; u < cleanUpKeywords.split(";").length; u++ ){
				newCleanUpKeywordsExpression += "myBody.indexOf('"+ cleanUpKeywords.split(";")[u]+"')>0";
				u != cleanUpKeywords.split(";").length-1 ? newCleanUpKeywordsExpression += " || " : "";
			}			
			//(str.search(/\bWidget\b/) >= 0)			
			var newForceKeywordsExpression ="";
			for( var f=0; f < forceKeywords.split(";").length; f++ ){
				newForceKeywordsExpression += "myBody.indexOf('"+ forceKeywords.split(";")[f]+"')>0";
				f != forceKeywords.split(";").length-1 ? newForceKeywordsExpression += " || " : "";
			}			
			//(str.search(/\bWidget\b/) >= 0)			
			var newCancelledKeywordsExpression ="";
			for( var x=0; x < cancelledKeywords.split(";").length; x++ ){
				newCancelledKeywordsExpression += "myBody.indexOf('"+ cancelledKeywords.split(";")[x]+"')>0";
				x != cancelledKeywords.split(";").length-1 ? newCancelledKeywordsExpression += " || " : "";
			}			
			//(str.search(/\bWidget\b/) >= 0)			
			var newInsertKeywordsExpression ="";
			for( var i=0; i< insertKeywords.split(";").length; i++ ){
				newInsertKeywordsExpression += "myBody.indexOf('"+ insertKeywords.split(";")[i]+"')>0";
				i != insertKeywords.split(";").length-1 ? newInsertKeywordsExpression += " || " : "";
			}			
			//(str.search(/\bWidget\b/) >= 0)			
			var newPCNKeywordsExpression ="";
			for( var p=0; p< pcnKeywords.split(";").length; p++ ){
				newPCNKeywordsExpression += "myBody.indexOf('"+ pcnKeywords.split(";")[p]+"')>0";
				p != pcnKeywords.split(";").length-1 ? newPCNKeywordsExpression += " || " : "";
			}
			
			//start
			document.getElementById("fakeProgress").style.display = "block";
			document.getElementById("resultOfManipulation").style.display = "block";
			startEmailsManipulation(newAbendNotifyKeywordsExpression,newRerunKeywordsExpression,newMcKeywordsExpression,newLongRunningKeywordsExpression,newHoldReleaseKeywordsExpression,newMissedDueOutKeywordsExpression,newCappingKeywordsExpression,newTpipeKeywordsExpression,newStuckKeywordsExpression,newCleanUpKeywordsExpression,newForceKeywordsExpression,newCancelledKeywordsExpression,newInsertKeywordsExpression,newPCNKeywordsExpression);
		}
		
		function timeStringConverter(timeInString){
			var d = new Date();
			timeInString.split(":")[0] > 12 ? timeInString = timeInString+" PM" : timeInString = timeInString+" AM"
			parts = timeInString.match(/(\d+)\:(\d+) (\w+)/),
			//["11:16 AM", "11", "16", "AM"]
			console.log(parts)
			minutes = parseInt(parts[2], 10);
			if( parts[3] == "AM" ) {
				hours = parseInt(parts[1], 10)
			}else{
				(parts[1] == 12) ? hours=parseInt(parts[1], 10) : hours=parseInt(parts[1], 10) + 12
			}
			console.log("hours->"+parseInt(parts[1], 10) + " minute-> "+minutes)
			d.setHours(parseInt(parts[1], 10),minutes,1);
			//d.setMinutes(minutes);
			return d;
		}
		
		var zjobs = [];
		var abendsTbody;
		var longRunningTbody;

		var convertedDate;
		var recipients;
		var globalEmailSubject;
		var globalEmail;
		var i = 1;
		var emailsGlobalVar ;
		function startEmailsManipulation(abendNotifyExpression,rerunExpression,mcExpression,longRunningExpression,holdReleaseExpression,missedDueOutExpression,cappingExpression,tpipeExpression,stuckExpression,cleanUpExpression,forceExpression,cancelledExpression,insertExpression,pcnExpression){
			var outlookApp = new ActiveXObject("Outlook.Application");
			var nameSpace = outlookApp.getNameSpace("MAPI");
			//nameSpace.logon("ja20076062@wipro.com","jjgm@WL6062",false,false);
			var mailFolder = nameSpace.GetDefaultFolder(6).Folders(document.getElementById("folderName").value).Items.Item(1).ConversationTopic;
			var emails = nameSpace.GetDefaultFolder(6).Folders(document.getElementById("folderName").value).Items;
			 emailsGlobalVar = emails;
			 abendsTbody = document.getElementById("abendsTbody");	
			 longRunningTbody = document.getElementById("longRunningTbody");	
			var emailCount = emails.count;
			document.getElementById("myBar").setAttribute("max",emails.count);
			console.log(emailCount)
			i = 0;
			resetCounter();
			document.getElementById("myBar2").setAttribute("class","progress-bar bg-danger progress-bar-striped progress-bar-animated")
			document.getElementById("emailsCountDisplay").textContent = emailCount;
			myLoop( emailCount,emails,abendNotifyExpression,rerunExpression,mcExpression,longRunningExpression,holdReleaseExpression,missedDueOutExpression,cappingExpression,tpipeExpression,stuckExpression,cleanUpExpression,forceExpression,cancelledExpression,insertExpression,pcnExpression);
			
			localStorage.setItem("lastname", "Manzon");
		}
		
		function myLoop ( emailCount,emails,abendNotifyExpression,rerunExpression,mcExpression,longRunningExpression,holdReleaseExpression,missedDueOutExpression,cappingExpression,tpipeExpression,stuckExpression,cleanUpExpression,forceExpression,cancelledExpression,insertExpression,pcnExpression) { 

		   setTimeout(function () { 
		   
			  var elem = document.getElementById("myBar");
			  var elem2 = document.getElementById("myBar2");
			  
				//finished manipulating emails
				if( i == emailCount ){ 
					console.log("100% complete.")
					document.getElementById("myBar").style.display = "none";
					document.getElementById("myBar2").setAttribute("class","progress-bar bg-success progress-bar-striped progress-bar-animated")
					document.getElementById("myBar2").innerHTML = "100% COMPLETE";
					//document.getElementById("fakeProgress").innerHTML = "<span style='width:100%' class='badge badge-pill badge-success'>100% COMPLETE </span>";
					document.getElementById("fakeProgress").style.display = "none";
					document.getElementById("resultOfManipulation").style.display = "none";
					//document.getElementById("showDebugButton").style.display = "block";
					//document.getElementById("btnExportAbends").style.display = "block";
					//document.getElementById("btnExportNonAbends").style.display = "block";
					elem2.setAttribute("style","width:"+parseInt( (i/emailCount)*100)+"%");
					return;
				}
			  //////////////////////////////////////////////////////////////////
					elem.value = i;
					elem2.setAttribute("style","width:"+parseInt( (i/emailCount)*100)+"%");
					console.log( parseInt( (i/emailCount)*100 ))
					elem2.innerHTML = parseInt( (i/emailCount)*100)+"%";
					document.getElementById("emailsCountStartDisplay").textContent = i;

 
				//console.log( emails )
				var theEmail = emails.Item(i+1);
				var myBody = theEmail.Body;
				var fullEmail = theEmail.Body; 
				var limitUntilLine = theEmail.Body.indexOf(document.getElementById("signatureName").value); //limit the search area
				myBody = myBody.substring(0,limitUntilLine);
				var emailSubject = theEmail.ConversationTopic;
				globalEmailSubject = theEmail.ConversationTopic;
				globalEmail = fullEmail;
				var site = "Jake";
					//compute Time column
					//occurence
					var previousEmailThread = fullEmail.slice(fullEmail.split("Sent:", 1).join("Sent:").length , fullEmail.split("Sent:", 1).join("Sent:").length+50); //get value of the nth Sent:
					var previousTime = previousEmailThread.slice( previousEmailThread.split(":", 2).join(":").length-2,previousEmailThread.split(":", 2).join(":").length+7).trim();
					//previousTime = "2:30 PM",
					console.log("previous email time-> \""+previousTime +"\"")
					if( previousTime != "") {
						var d = new Date();
						parts = previousTime.match(/(\d+)\:(\d+) (\w+)/),
						//["11:16 AM", "11", "16", "AM"]
						//hours = /am/i.test(parts[3]) ? parseInt(parts[1], 10) : parseInt(parts[1], 10) + 12,
						minutes = parseInt(parts[2], 10);
						//( parts[2].split("")[0] === "0" ) ? minutes = : minutes = parseInt(parts[2], 10)
						if( parts[3] == "AM" ) {
							hours = parseInt(parts[1], 10)
						}else{
							(parts[1] == 12) ? hours=parseInt(parts[1], 10) : hours=parseInt(parts[1], 10) + 12
						}
						d.setHours(hours);
						d.setMinutes(minutes);
						previousTime = d.getHours()+":"+d.toTimeString().split(":")[1];
						console.log("previous Time trimmed: \"" +d.getHours()+":"+d.toTimeString().split(":")[1] +"\"")
					}else{ //no previousEmailThread
						previousTime = "";
						console.log("second "+previousTime)
						//console.log("previouseTime is null");
					}
					
				console.log(i)
				//site = theEmail.ConversationTopic.split("|")[0].split(" ")[0];
				if( emailSubject.indexOf("LE") >= 0 && emailSubject.indexOf("LE") <= 5){
					site = "LE"
				}else if ( emailSubject.indexOf("YR") >= 0 && emailSubject.indexOf("YR") <= 5){
					site = "YR"
				}else if ( emailSubject.indexOf("Y2") >= 0 && emailSubject.indexOf("Y2") <= 5){
					site = "Y2"
				}else if ( emailSubject.indexOf("UM") >= 0 && emailSubject.indexOf("UM") <= 5){
					site = "UM"
				}else if ( emailSubject.indexOf("MM") >= 0 && emailSubject.indexOf("MM") <= 5){
					site = "MM"
				}else{
					site ="Undefined"
				}
				
				var myDate = theEmail.SentOn;
				convertedDate = new Date(myDate);
				recipients = theEmail.cc + theEmail.to; //to,cc,bcc
				console.log("recipient: " +recipients);
				//Time manipulation
				var emailTimeSent = theEmail.SentOn;
				var timeColumnConvertedDate = new Date(emailTimeSent);
				var tempDate = new Date();
				tempDate.setHours( timeColumnConvertedDate.getHours() );
				tempDate.setMinutes( timeColumnConvertedDate.getMinutes() );
				tempDate.setSeconds( timeColumnConvertedDate.getSeconds() );
				
				//Turn over expression
				if( emailSubject.toUpperCase().indexOf("TURNOVER") >=0 ){
					var title = [emailSubject]
					//var site = "";
					var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - 0 )).toTimeString().split(" ")[0];;
				    timeResult = timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1]
					var action = "DTS Shift Turnover (turnover)";
					var logType = "turnover";
					var recipient = "";
					console.log("email["+i +","+emailSubject+"]-> Turnover- 1 found")
					document.getElementById("resultOfManipulation").textContent = zjobs.length+" turnover found"
					displayRow(title,site,convertedDate,timeResult,action,logType,recipients,globalEmailSubject,i+1);
					 
					 
					//if( i <= emailCount ){
						elem.value = i;
						elem2.setAttribute("style","width:"+parseInt( (i/emailCount)*100)+"%");
						elem2.innerHTML = parseInt( (i/emailCount)*100)+"%";
						myLoop(emailCount,emails,abendNotifyExpression,rerunExpression,mcExpression,longRunningExpression,holdReleaseExpression,missedDueOutExpression,cappingExpression,tpipeExpression,stuckExpression,cleanUpExpression,forceExpression,cancelledExpression,insertExpression,pcnExpression);     
						document.getElementById("emailsCountStartDisplay").textContent = i;
						i++; 
					//}
					return
				}
				//PCN expression
				/**
				if( emailSubject.toUpperCase().indexOf("PCN") >=0 ){
					var title = [emailSubject.split(" ")[2]]
					//var title = [emailSubject.substring( emailSubject.indexOf("PCN"),emailSubject.indexOf(" ",emailSubject.indexOf(" ") + 1  ) )]
					var site = emailSubject.split(" ")[0];
					var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - 0 )).toTimeString().split(" ")[0];;
				    var action = "PCN";
					var logType = "pcn";
					var recipient = theEmail.cc;
					console.log("email["+i +","+emailSubject+"]-> PCN-"+zjobs.length+" found")
					document.getElementById("resultOfManipulation").textContent = zjobs.length+" PCN found"
					displayRow(title,site,convertedDate,timeResult,action,logType,recipient,globalEmailSubject);
					
						elem.value = i;
						elem2.setAttribute("style","width:"+parseInt( (i/emailCount)*100)+"%");
						elem2.innerHTML = parseInt( (i/emailCount)*100)+"%";
						myLoop(emailCount,emails,abendNotifyExpression,rerunExpression,mcExpression,longRunningExpression,holdReleaseExpression,missedDueOutExpression,cappingExpression,tpipeExpression,stuckExpression,cleanUpExpression,forceExpression,cancelledExpression,insertExpression);     
					document.getElementById("emailsCountStartDisplay").textContent = i;
					i++;  
					return
				}				
				**/
					
					//-> PCN expression=> myBody.indexOf("inserted") >0 
					if( eval(pcnExpression) ){
						var logType = "pcn";
						var action = "PCN";
						var where = "pcn";	
						var title = [emailSubject];
						var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - pcnMinute )).toTimeString().split(" ")[0];
						//extractJobs(emailSubject,myBody,where,fullEmail);
						console.log("email["+i +","+emailSubject+"]-> PCN-" +zjobs.length+" found")
						document.getElementById("resultOfManipulation").textContent = zjobs.length+" pcn found"
						console.log(timeResult)
						displayRow(title,site,convertedDate,timeResult,action,logType,recipients,globalEmailSubject,i+1);
					}	
					
					
				//if( emailSubject.indexOf("ABEND") > 0 ){
				//	if( emailSubject.indexOf("*")>0 || emailSubject.indexOf("MULTIPLE")>0 || emailSubject.indexOf("&") > 0){ //multiple job
				//		zjobs = extractJobs(myBody);
				//	}else{ //single job
				//		var jobname =  emailSubject.split("|")[1].split(" ")[2];
				//		zjobs.push(jobname);
				//	}
				//}else{ 
				//	var jobname =  emailSubject.split("|")[1].split(" ")[2];
				//	zjobs.push(jobname);
				//}
				
				
				//var rerunMinute = 5; 
				//var notifyMinute = 3; 
				//var markCompleteMinute = 2; 
				//var longRunningMinute = 3;
				
				//find Action
				//if( emailSubject.indexOf("ABEND") > 0){ //abends
					var logType = "abend";
				//-> MC expression=> myBody.indexOf("NO RECOVERY REQUIRED")>0 || myBody.indexOf("marked") >0
					if( eval(mcExpression) || myBody.indexOf("NO RECOVERY REQUIRE")>0 ){ //mark complete
						var action = "";
						//var timeResult;
						var tempPreviousTime = previousTime;
						globalPreviousEmailTime = previousTime;
						if( tempPreviousTime == "" ){//if preivousTime is null -> means no previous time found in email 
							tempPreviousTime = new Date(tempDate.setMinutes( tempDate.getMinutes() - 3 )).toTimeString().split(" ")[0]; //-3mins by default
							tempPreviousTime =  tempPreviousTime.slice(0 , tempPreviousTime.indexOf(":")+3 ) ; //trim time " '11:20':39"
						}
						/**
						else{ //there is previous time found in email
							//calculate difference in minutes
							var difference = Math.round( ((( timeStringConverter( convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1])-timeStringConverter(tempPreviousTime) )) /1000)/60 )
							//console.log( (convertedDate.toTimeString().split(" ")[0].split(":")[0] > 12) ? timeStringConverter( convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1]) +" PM" : timeStringConverter( convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1]) )
							console.log( timeStringConverter(convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1]))
							console.log( timeStringConverter(tempPreviousTime) )
							//console.log("result difference1: " + difference);
							// difference>=117 || (difference>=117 && site="YR") || (difference>=119 && myBody.indexOf("ps22")>0)
							console.log("difference-> ("+convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1]+"-" +tempPreviousTime+") " + difference + " minutes")
							
							if( difference >= 119  ){ // > minutes ---(i.e)---> mc if no response in 2hours(120mins-YR) | (15mins-Y2)
								//adjust time column in 2 hours
								//["11:16 AM", "11", "16", "AM"]
								tempPreviousTime.split(":")[0] > 12 ? tempPreviousTime = tempPreviousTime+" PM" : tempPreviousTime = tempPreviousTime+" AM"
								var d = new Date();
								var hours;
								var minutes = parseInt(tempPreviousTime.split(":")[1], 10);
								if( tempPreviousTime.split(" ")[1] == "AM" ) { //+2 hours
									hours = parseInt(tempPreviousTime.split(":")[0], 10)+2
								}else{ //+hours
									(tempPreviousTime.split(":")[0] == 12) ? hours=parseInt(tempPreviousTime.split(":")[0], 10)+2 : hours=parseInt(tempPreviousTime.split(":")[0], 10) + 14 
								}
								d.setHours(hours);
								d.setMinutes(minutes);
								//console.log("result difference: " );
								//console.log(d)
								tempPreviousTime = d.getHours()+":"+d.toTimeString().split(":")[1];
								console.log("end time-> " + tempPreviousTime)
								console.log("minute-> " +minutes)
							}
						}
						*/
						var where = "NO RECOVERY REQUIRED";
						extractJobs(emailSubject,myBody,where,fullEmail);
						console.log("email("+i +")-> mc-"+zjobs.length+" found")
						
						if( myBody.indexOf("ps25")>0 || myBody.indexOf("ps22")>0 || myBody.indexOf("recovery instruction")>0){ //as per?ps25
							console.log(theEmail.Body.indexOf("ps25"))
							action = "mark complete as per ps25";
							//timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - markCompleteMinute )).toTimeString().split(" ")[0];
							console.log("mcMinute: " +tempDate.getMinutes() - markCompleteMinute)
						}else{
							action = "mark complete as per programmer";
							//timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - markCompleteMinute )).toTimeString().split(" ")[0];
						}
						document.getElementById("resultOfManipulation").textContent = zjobs.length+" " + action+" found"
						displayRow(zjobs,site,convertedDate,tempPreviousTime,action,logType,recipients,globalEmailSubject,i+1,fullEmail,myBody);
					}

			  //-> Abend Notify expression=> myBody.indexOf("advise")>0 ||myBody.indexOf("check and advise")>0 || myBody.indexOf("Updating abends")>0 || (myBody.indexOf("check")>0 && myBody.indexOf("WAITING T/S")>0 )|| myBody.indexOf("Updating")>0
					if(  eval(abendNotifyExpression) && emailSubject.toUpperCase().indexOf("ABEND") >=0 || (myBody.indexOf("check")>0 && myBody.indexOf("WAITING T/S")>0 ) ){ // notify
						var tempPreviousTime = previousTime;
												// || //there is "kindly also check.. in full email"
						if( tempPreviousTime == "" || (tempPreviousTime != ""  && fullEmail.split("Sent:").length > 2 ) ){//if preivousTime is 0 -> means no previous time in email
							tempPreviousTime = new Date(tempDate.setMinutes( tempDate.getMinutes() - 3 )).toTimeString().split(" ")[0];
							tempPreviousTime =  tempPreviousTime.slice(0 , tempPreviousTime.indexOf(":")+3 ) ; //trim time "11:20:39"
						}
						
						var action = "notify programmer";
						var where = "WAITING T/S"; //some email forgot the whole status
						//var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - notifyMinute )).toTimeString().split(" ")[0];

						extractJobs(emailSubject,myBody,where,fullEmail);
						console.log("email["+i +","+emailSubject+"]-> notify-"+zjobs.length+" found")
						document.getElementById("resultOfManipulation").textContent = zjobs.length+" notify found"
						displayRow(zjobs,site,convertedDate,tempPreviousTime,action,logType,recipients,globalEmailSubject,i+1);
					}
					
					//var logType = "abend";
					//displayRow(zjobs,site,convertedDate,timeResult,action,logType,recipients);
				
				//}else{ // long running
				//-> RR expression=> myBody.indexOf("been rerun")>0 || myBody.indexOf("RECOVERY FAILED") > 0
					if( eval(rerunExpression) ){ //rerun || RR as per ps25
						// || myBody.indexOf("RECOVERY FAILED") > 0
						var where = "RECOVERY";
						//singleOrMultipleJobs(emailSubject,myBody,where);
						//var emailSubject = "";
							var temp =fullEmail;
							//calculate Time column
							var previousSent = temp.slice(temp.split("Sent:", 1).join("Sent:").length,temp.split("Sent:", 1).join("Sent:").length+50);
							var previousTime = previousSent.slice( previousSent.split(":", 2).join(":").length-2,previousSent.split(":", 2).join(":").length+7).trim();
							console.log("previousTime: "+previousTime)
						
						extractJobs(emailSubject,myBody,where,fullEmail,tempDate,site,i+1);
						//console.log("email("+i +")-> rerun-"+zjobs.length+" found")
						//var action = "rerun as per programmer";
						//var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - rerunMinute )).toTimeString().split(" ")[0];
						//displayRow(zjobs,site,convertedDate,timeResult,action,logType,recipients);
					}
			  //-> LR expression=> myBody.indexOf("running ") >0
					if( eval(longRunningExpression) && emailSubject.toUpperCase().indexOf("RUNNING") >=0 ){
						var logType = "longRunning";
						var action = "long running";
						var where = "longRunning";			
						var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - 3 )).toTimeString().split(" ")[0];
						
						/**var tempPreviousTime = previousTime;
						globalPreviousEmailTime = previousTime;
						if( tempPreviousTime == "" ){//if preivousTime is null -> means no previous time found in email 
							tempPreviousTime = new Date(tempDate.setMinutes( tempDate.getMinutes() - 3 )).toTimeString().split(" ")[0]; //-3mins by default
							tempPreviousTime =  tempPreviousTime.slice(0 , tempPreviousTime.indexOf(":")+3 ) ; //trim the time " '11:20':39"
						}
						*/
						extractJobs(emailSubject,myBody,where,fullEmail);				
						console.log("email["+i +","+emailSubject+"]-> longRun-" +zjobs.length+" found")
						document.getElementById("resultOfManipulation").textContent = zjobs.length+" long Running found"
						displayRow(zjobs,site,convertedDate,timeResult,action,logType,recipients,globalEmailSubject,i+1);
					}
				  //-> Hold & release expression=> myBody.indexOf("HELD") >0 || myBody.indexOf("RELEASED") >0
					if( eval(holdReleaseExpression) ){
						var logType = "holdRelease";
						var action = "Hold and Release of jobs";
						var where = "holdRelease";			
						var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - holdReleaseMinute )).toTimeString().split(" ")[0];
						extractJobs(emailSubject,myBody,where,fullEmail);				
						console.log("email["+i +","+emailSubject+"]-> hold & release-" +zjobs.length+" found")
						document.getElementById("resultOfManipulation").textContent = zjobs.length+" hold & release found";
						displayRow(zjobs,site,convertedDate,timeResult,action,logType,recipients,globalEmailSubject,i+1);
					}				 
					//-> missed due-out expression=> myBody.indexOf("LATE") >0 || myBody.indexOf("missed") >=0
					if( eval(missedDueOutExpression) ){
						var logType = "missedDue";
						var action = "Missed Due Out";
						var where = "missedDue";			
						var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - missedDueOutMinute )).toTimeString().split(" ")[0];
						extractJobs(emailSubject,myBody,where,fullEmail);				
						console.log("email["+i +","+emailSubject+"]-> missedDueout-" +zjobs.length+" found")
						document.getElementById("resultOfManipulation").textContent = zjobs.length+" missed Due-out found";
						displayRow(zjobs,site,convertedDate,timeResult,action,logType,recipients,globalEmailSubject,i+1);
					}					
					//-> Capping expression=> myBody.indexOf("quick view") >0 && myBody.indexOf("%") >=0
					if( eval(cappingExpression) && myBody.indexOf("%") >=0){
						var title = [emailSubject];
						var site = "Undefined";
						var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - cappingMinute )).toTimeString().split(" ")[0];;
						var action = "Capping";
						var logType = "capping";
						var recipient = "";
						console.log("email["+i +","+emailSubject+"]-> Capping-"+zjobs.length+" found")
						document.getElementById("resultOfManipulation").textContent = zjobs.length+" capping found"
						displayRow(title,site,convertedDate,timeResult,action,logType,recipients,globalEmailSubject,i+1);
						 
						//i++;  
						//if( i <= emailCount ){
						//	myLoop(emailCount,emails,abendNotifyExpression,rerunExpression,mcExpression,longRunningExpression,holdReleaseExpression,missedDueOutExpression,cappingExpression);     
						//}
						
						//return
					}					
					//-> Tpipe expression=> myBody.indexOf("TPIPE") >0 || myBody.indexOf("L$") >=0
					if( fullEmail.indexOf("TPIPE") >0 || fullEmail.indexOf("L$") >=0 ){
						var myArray = myBody.split("\n");
						var mySecondArray = fullEmail.split("\n");
						//console.log(limitUntilLine +":"+ fullEmail.split("\n").length)
						
						if( fullEmail.split("From").length == 2 ){
							
							var title = [];
							for( var j = myArray.length; j <=mySecondArray.length-1; j++ ){
								var lineN = mySecondArray[j];
								if( lineN.indexOf("L$") >= 0 ){
									if( title.indexOf(temp) < 0 ){ //-1 if not found
										var temp = lineN.substring( lineN.indexOf("L$"), lineN.indexOf("L$") + 6).trim();
										title.push(temp)									
									}
								}
							}
							
							var site = "Undefined";
							var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - 3 )).toTimeString().split(" ")[0];;
							timeResult = timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1]
							var action = "Tpipe";
							var logType = "tpipe";
							var recipient = "";
							console.log("email["+i +","+emailSubject+"]-> Turnover-"+zjobs.length+" found")
							document.getElementById("resultOfManipulation").textContent = zjobs.length+" tpipe found"
							displayRow(title,site,convertedDate,timeResult,action,logType,recipients,globalEmailSubject,i+1);
						}
					}
					//-> Stuck in Submit expression=> myBody.indexOf("stuck in submit") >0 
					if( eval(stuckExpression) ){
						var logType = "stuckInSubmit";
						var action = "Stuck in Submit";
						var where = "stuck";			
						var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - stuckMinute )).toTimeString().split(" ")[0];
						extractJobs(emailSubject,myBody,where,fullEmail);
						console.log("email["+i +","+emailSubject+"]-> stuck-" +zjobs.length+" found")
						document.getElementById("resultOfManipulation").textContent = zjobs.length+" stuck found"
						displayRow(zjobs,site,convertedDate,timeResult,action,logType,recipients,globalEmailSubject,i+1);
					}
					//-> CleanUp expression=> myBody.indexOf("clean job") >0 || myBody.indexOf("clear off") >0
					if( eval(cleanUpExpression) ){
						var logType = "cleanUp";
						var action = "PPC05 CLEAN UP";
						var where = "cleanUp";			
						var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - 0 )).toTimeString().split(" ")[0];
						extractJobs(emailSubject,myBody,where,fullEmail);
						console.log("email["+i +","+emailSubject+"]-> cleanUp-" +zjobs.length+" found")
						document.getElementById("resultOfManipulation").textContent = zjobs.length+" clean up found"
						displayRow(zjobs,site,convertedDate,timeResult,action,logType,recipients,globalEmailSubject,i+1);
					}
					//-> Force expression=> myBody.indexOf("force") >0 
					if( eval(forceExpression) ){
						var logType = "force";
						var action = "Force running";
						var where = "force";			
						var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - 3 )).toTimeString().split(" ")[0];
						extractJobs(emailSubject,myBody,where,fullEmail);
						console.log("email["+i +","+emailSubject+"]-> force-" +zjobs.length+" found")
						document.getElementById("resultOfManipulation").textContent = zjobs.length+" force found"
						displayRow(zjobs,site,convertedDate,timeResult,action,logType,recipients,globalEmailSubject,i+1);
					}					
					//-> Insert expression=> myBody.indexOf("inserted") >0 ||  ADDED BY RUSH || HAS BEEN ADDED TO THE SCHEDULE
					if( eval(insertExpression) ){
						var logType = "inserted";
						var action = "Inserting of jobs";
						var where = "insert";			
						//var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - 3 )).toTimeString().split(" ")[0];
						var tempPreviousTime = previousTime;
						globalPreviousEmailTime = previousTime;
						if( tempPreviousTime == "" ){//if preivousTime is null -> means no previous time found in email 
							tempPreviousTime = new Date(tempDate.setMinutes( tempDate.getMinutes() - 3 )).toTimeString().split(" ")[0]; //-3mins by default
							tempPreviousTime =  tempPreviousTime.slice(0 , tempPreviousTime.indexOf(":")+3 ) ; //trim the time " '11:20':39"
						}

						extractJobs(emailSubject,myBody,where,fullEmail);
						console.log("email["+i +","+emailSubject+"]-> Insert-" +zjobs.length+" found")
						document.getElementById("resultOfManipulation").textContent = zjobs.length+" inserted found"
						displayRow(zjobs,site,convertedDate,tempPreviousTime,action,logType,recipients,globalEmailSubject,i+1);
					}	
					//-> Cancelled expression=> myBody.indexOf("cancelled") >0 
					if( eval(cancelledExpression) ){
						var logType = "cancelled";
						var action = "Cancelling of jobs";
						var where = "cancelled";			
						var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - 3 )).toTimeString().split(" ")[0];
						extractJobs(emailSubject,myBody,where,fullEmail);
						console.log("email["+i +","+emailSubject+"]-> cancelled-" +zjobs.length+" found")
						document.getElementById("resultOfManipulation").textContent = zjobs.length+" cancelling of jobs found"
						displayRow(zjobs,site,convertedDate,timeResult,action,logType,recipients,globalEmailSubject,i+1);
					}
					//Duke and I have successfully created a program that turns our manual 
					//creation of logs(Abend & Non-abend) into an automated one. You can use it if you want to.
					// As of now we were still detecting some minor errors but we were  
					//able to turn it around.
					
			  //////////////////////////////////////////////////////////////////
			  if (i <= emailCount) {
				elem.value = i;
				elem2.setAttribute("style","width:"+parseInt( (i/emailCount)*100)+"%");
				elem2.innerHTML = parseInt( (i/emailCount)*100)+"%";
				myLoop(emailCount,emails,abendNotifyExpression,rerunExpression,mcExpression,longRunningExpression,holdReleaseExpression,missedDueOutExpression,cappingExpression,tpipeExpression,stuckExpression,cleanUpExpression,forceExpression,cancelledExpression,insertExpression,pcnExpression);     
				document.getElementById("emailsCountStartDisplay").textContent = i;
			  i++;                    
			  }
				
		   }, 300)
		   
		   
		}



		function singleOrMultipleJobs(emailSubject,myBody,where){
			zjobs.length = 0; //empty the array
			//if( emailSubject.indexOf("ABEND") > 0 ){
			//	if( emailSubject.indexOf("*")>0 || emailSubject.indexOf("MULTIPLE")>0 || emailSubject.indexOf("&") > 0){ //multiple job
			//		zjobs = extractJobs(myBody);
			//	}else{ //single job
			//		var jobname =  emailSubject.split("|")[1].split(" ")[2];
			//		zjobs.push(jobname);
			//	}
			//}
		
		}
		function extractJobsNotify(emailSubject,myBody,where){
			zjobs = [];
			var myArray = myBody.split("\n");
			var result = [];
			if( emailSubject.indexOf("*")>0 || emailSubject.indexOf("MULTIPLE")>0 || emailSubject.indexOf("&") > 0){ //multiple job
				for( var j = 0; j < myArray.length; j++){
					var lineN = myArray[j];
					var myTable = document.getElementById("abendsTbody");
					if( lineN.indexOf("Z") >=0  ){ //if line has a char 'Z', then there is a job
						if( myTable.rows.length > 0 ){ //chech for duplicate jobs when notifying programmer || updating abends
							for (var i = 0; i < myTable.rows.length; i++) { 
							   if( (myTable.rows[i].childNodes[0].innerHTML).indexOf(lineN.substring(lineN.indexOf("Z"),8)) >=0 ){//if duplicate jobs
								//console.log((myTable.rows[i].childNodes[0].innerHTML).indexOf(lineN.substring(lineN.indexOf("Z"),8)) >=0)
								console.log( "Duplicate => " +(myTable.rows[i].childNodes[0].innerHTML) + " == " + lineN.substring(lineN.indexOf("Z"),8))
								return;
							   }
							} 
						}
						var zjobTemp = lineN.trim().substring(0,9)
						zjobs.push( zjobTemp ) //get only the Zjob

					}
				}

				
			}else{ //single job
				//var jobname =  emailSubject.split("|")[1].split(" ")[2];
				var jobname =  emailSubject.split("|")[1].split(" ")[2];
				zjobs.push(jobname);
			}
		}
		function extractJobs(emailSubject,myBody,where,fullEmail,tempDate,site,emailIndex){
			var zjobsTemp = [];
			var zjobsRecoveryActive = [];
			var zjobsRecoveryFailed = [];
			zjobs.length = 0;
			var myArray = myBody.split("\n");
			var mySecondArray = fullEmail.split("\n");
			var result = [];
			//get all zjobs first and then compare it to full email thread-if there is duplicate-then someone already report it
			for( var j = 0; j < myArray.length; j++){
				var lineN = myArray[j];
				//if( lineN.indexOf("Z") >= 0  ){ //if line has a char 'Z', then there is a job
					//console.log( lineN.substring(lineN.indexOf("Z"),8))//get all Zjobs 
				//	result.push( lineN.substring(lineN.indexOf("Z"),8) )
				//	if( myArray[j+2].indexOf("Z") < 0 ){
				//		break;
				//	}
				//}
				if( where == "longRunning" ){//long running
					//correct->> //lineN.trim().indexOf("Z") >= 0 && lineN.trim().indexOf("Z") < 3
					if( (lineN.trim().indexOf("Z") >= 0 && lineN.trim().indexOf("Z") < 3) && (lineN.trim().indexOf("ACTIVE") >= 0 || lineN.trim().indexOf(":") >= 0) ){
						//var temp = lineN.trim().split(" ")[0];
						//var temp = lineN.trim().substring(0,8);
						var temp = lineN.trim().replace(/\s+/g, "-").split("-")[0];
						zjobsTemp.push(temp);
						zjobs.push( temp )
					}
				}else if( where == "holdRelease"){
					if( lineN.trim().indexOf("Z") >= 0 && (lineN.trim().indexOf("HELD") > 0 || lineN.trim().indexOf("RELEASED") > 0) ){
						//var temp = lineN.trim().substring(0,8);
						var temp = lineN.trim().split(",")[2].split("-")[0].trim()
						zjobsTemp.push(temp);
						zjobs.push( temp )
					}

				}else if( where == "stuck" ||  where == "force"){
					if( lineN.trim().indexOf("Z") >= 0 && lineN.trim().replace(/\s+/g, "-").split("-")[3] == 'S'){
						//console.log( lineN.trim().replace(/\s+/g, "-").split("-")[3] )
						var temp = lineN.trim().replace(/\s+/g, "-").split("-")[0];
						zjobsTemp.push(temp);
						zjobs.push( temp )
					}
	
				}else if( where == "insert"){
					if( (lineN.trim().indexOf("Z") >= 0 && lineN.trim().replace(/\s+/g, "-").split("-")[3] == 'R' || (lineN.trim().indexOf("ADDED BY RUSH") > 0) )){
						//console.log( lineN.trim().replace(/\s+/g, "-").split("-")[3] )
						var temp = lineN.trim().replace(/\s+/g, "-").split("-")[0];
						zjobsTemp.push(temp);
						zjobs.push( temp )
					}
					if( (lineN.trim().indexOf("HAS BEEN ADDED TO THE SCHEDULE")>0 ) ){
						var temp = lineN.trim().split(",")[2].split(" ")[0].trim(); //5PT6,SCDBSINT,ZTPS110  HAS BEEN ADDED TO THE SCHEDULE
						zjobsTemp.push(temp);
						zjobs.push( temp )
					}
				}else if( where == "cancelled"){
					if( lineN.trim().indexOf("Z") >= 0 && lineN.trim().replace(/\s+/g, "-").split("-")[3] == 'X'){
						//console.log( lineN.trim().replace(/\s+/g, "-").split("-")[3] )
						console.log("called called")
						var temp = lineN.trim().replace(/\s+/g, "-").split("-")[0];
						zjobsTemp.push(temp);
						zjobs.push( temp )
					}
				}else if( where == "cleanUp" ){
					if( lineN.trim().indexOf("Z") >= 0 && lineN.indexOf("ACTIVE") >= 0 ){
						//console.log( lineN.trim().replace(/\s+/g, "-").split("-")[3] )
						var temp = lineN.trim().replace(/\s+/g, "-").split("-")[0];
						zjobsTemp.push(temp);
						zjobs.push( temp )
					}
				}else if( where == "NO RECOVERY REQUIRED" ){ //MC ps25 ?
					if( lineN.trim().indexOf("Z") >= 0 && lineN.indexOf("NO RECOVERY REQUIRE") >= 0 ){
						var temp = lineN.trim().replace(/\s+/g, "-").split("-")[0];
						zjobsTemp.push(temp);
						zjobs.push( temp )
					}
				}else{ //abend
					//get all zjobs first and then compare it to full email thread-if there is duplicate-then someone already report it
					if( lineN.trim().indexOf("Z") >= 0 && lineN.trim().indexOf("Z") <3 && lineN.indexOf(where) >= 0 ){
						if( where == "RECOVERY" ){ //RECOVERY ACTIVE || RECOVERY FAILED => job has been rerun || RR as ps25
							if( lineN.indexOf("RECOVERY ACTIVE") > 0 ){
								var temp = lineN.substring( lineN.indexOf("Z")).replace(/\s+/g, "-").split("-")[0];
								//zjobsTemp.push(temp);
								zjobsRecoveryActive.push( temp )
							}
							if( lineN.indexOf("RECOVERY FAILED") > 0 ){
								var temp = lineN.substring( lineN.indexOf("Z")).replace(/\s+/g, "-").split("-")[0];
								//zjobsTemp.push(temp);
								zjobsRecoveryFailed.push( temp )
							}
							
						}else{ 

							var temp = lineN.substring( lineN.indexOf("Z")).replace(/\s+/g, "-").split("-")[0];
							zjobsTemp.push(temp);
							zjobs.push( temp )
						}
																
					}
				}
				
				//if( lineN.indexOf(where) >= 0  ){
				//	var zjobTemp = lineN.trim().substring(0,9)//correct
				//	zjobs.push( zjobTemp )//correct
				//}

				//if( lineN.indexOf("Warm Regards") >= 0 ){
				//	return;
				//}
			}
			
			//for missed due-out 
			if( where == "missedDue" ){//missed due out
				for( var k = 0; k < mySecondArray.length; k++ ){
					var lineN = mySecondArray[k];
					if( lineN.trim().indexOf("Z") >= 0 && (lineN.trim().indexOf("LATE") > 0 ) ){
						var temp = lineN.trim().split(" ")[0].trim()
						zjobsTemp.push(temp);
						zjobs.push( temp )
					}
				}
				if( zjobs.length == 0 ){ //if no found in email body, get from the subject
					var jobname =  emailSubject.substring( emailSubject.indexOf("Z")  )  
						zjobsTemp.push(jobname)
						//zjobs.push( temp )
						zjobs.push( jobname )
				}
			}
			
								
			console.log("zjobs") 
			console.log(zjobs) 
			if( where == "RECOVERY" ){ //rerun
				var splitFrom = fullEmail.split("From");
				if( zjobsRecoveryActive.length > 0 ){

					console.log(zjobsRecoveryActive) 
					//for( var s=0; s < zjobsRecoveryActive.length; s++ ){ //RR as programmer
						var logType = "abend";
						var action = "rerun as per programmer";
						var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - rerunMinute )).toTimeString().split(" ")[0];
						//var timeResult = "fix";
						//var oneAtATime = [];
						//oneAtATime.push(zjobsTemp[s])
						displayRow(zjobsRecoveryActive,site,convertedDate,timeResult,action,logType,recipients,globalEmailSubject,emailIndex);
						//zjobs.splice( zjobs.indexOf(zjobsTemp[s]), 1) //remove job zjobs array
								
					//}
						console.log("email("+emailSubject +")-> rerun-"+zjobsRecoveryActive.length+" found")
						
				}
				console.log( "urMail:"+myArray.length + " : wholeMail"+mySecondArray.length)
				if( zjobsRecoveryFailed.length > 0 ){ //RR as programmer || RR as ps25
				
					console.log(zjobsRecoveryFailed) 
					var zjobsRRps25 = [];
					var zjobsRRprogrammer = [];
					var indexOfAutoEmail = 0;
					for( var y = myArray.length; y < mySecondArray.length; y++){ //clear zjobs that was rerun
						var lineN = mySecondArray[y];
						if( lineN.indexOf( "From: pcp2@msg.ti.com [mailto:pcp2@msg.ti.com] " ) >= 0  ){
							var from = lineN.indexOf( "From: dts@msg.ti.com [mailto:dts@msg.ti.com]" );
							var fromNumberline = mySecondArray.indexOf(mySecondArray[y]);
							indexOfAutoEmail = fromNumberline;
							//console.log(indexOfAutoEmail)
						}
						
						if( (lineN.indexOf( "Z" ) >= 0 && splitFrom.length>2) || (lineN.indexOf( "Z" ) >= 0 && lineN.indexOf( "RECOVERY" ) >0) || (lineN.indexOf( "Z" ) >= 0 && !(y>indexOfAutoEmail)) && y <= mySecondArray.length-1 ) {  //RR as programmer
							for( var h=0; h < zjobsRecoveryFailed.length; h++ ){//remove all duplicates
								if( lineN.trim().indexOf( zjobsRecoveryFailed[h] ) >=0  ){
									console.log("programmer")
									//zjobsRRprogrammer.push(zjobsRecoveryFailed[h] ) 
									zjobsRecoveryFailed.splice( zjobsRecoveryFailed.indexOf(zjobsTemp[h]), 1) //remove job zjobs array
					  //correct->  //zjobsRecoveryFailed.splice( zjobsRecoveryFailed.indexOf(zjobsTemp[h]), 1) //remove job zjobs array
									break;
								}
	
							}
							if( y == mySecondArray.length-1 && zjobsRecoveryFailed.length >= 0){
								console.log("in")
								zjobsRRprogrammer = zjobsRecoveryFailed;
							}
						}
						//console.log(splitFrom.length)
						if( (lineN.indexOf( "Z" ) >= 0 && splitFrom.length <=2 ) || splitFrom.length ==1 && y <= mySecondArray.length-1 ){ //RR as ps25
							for( var h=0; h < zjobsRecoveryFailed.length; h++ ){
								if( lineN.trim().indexOf( zjobsRecoveryFailed[h] ) >=0  ){
									console.log("ps25-1")
									zjobsRRps25.push(zjobsRecoveryFailed.splice( h-1, 1) ) 
									//console.log(zjobsRecoveryFailed.splice( zjobsRecoveryFailed.indexOf(zjobsRecoveryFailed[h]), 1)) //remove job zjobs array
									break;
								}
							}
							
							if(splitFrom.length ==1){
								console.log("ps25-2")
								for( var h=0; h < zjobsRecoveryFailed.length; h++ ){
									zjobsRRps25.push(zjobsRecoveryFailed[h] )
									zjobsRecoveryFailed.splice( h-1, 1) //remove job zjobs array
									break;
								}
							}
							
							if( y == mySecondArray.length-1 && zjobsRecoveryFailed.length > 0){
								zjobsRRps25 = zjobsRecoveryFailed;
							}
						

						}
						
						if( y == mySecondArray.length-1){
							console.log("point")
							console.log(zjobsRecoveryFailed)
							if( zjobsRRprogrammer.length >0 ){
								for( var h=0; h < zjobsRRprogrammer.length; h++ ){//RR as programmer
									var logType = "abend";
									var action = "rerun as per programmer";
									var timeResult = new Date(tempDate.setMinutes( tempDate.getMinutes() - rerunMinute )).toTimeString().split(" ")[0];
									//var timeResult = "fix";
									var oneAtATime = [];
									oneAtATime.push(zjobsRRprogrammer[h])
									displayRow(oneAtATime,site,convertedDate,timeResult,action,logType,recipients,globalEmailSubject,emailIndex);
									console.log("email("+emailSubject +")-> rerunAsProgrammer- 1 found")
									document.getElementById("resultOfManipulation").textContent = zjobs.length+" rerun as per programmer found"
									zjobsRRprogrammer.splice( zjobsRRprogrammer.indexOf(zjobsTemp[h]), 1) //remove job zjobs array
									//console.log(zjobsTemp)
								}
							}
						}
					}
					//console.log(zjobsRecoveryFailed)
					
					//console.log(zjobsRRps25)
					if( zjobsRRps25.length > 0){
						for( var h=0; h < zjobsRRps25.length; h++ ){//RR as Ps25
							var logType = "abend";
							var action = "rerun as per PS25";
							var ps25TempDate = new Date(tempDate);
							var timeResult = new Date(ps25TempDate.setMinutes( ps25TempDate.getMinutes() - 2 )).toTimeString().split(" ")[0];
							//var timeResult = "fix";
							var oneAtATime = [];
							oneAtATime.push(zjobsRRps25[h])
							displayRow(oneAtATime,site,convertedDate,timeResult,action,logType,recipients,globalEmailSubject,emailIndex);
							console.log("email("+emailSubject +")-> rerunAsPs25- 1 found")
							document.getElementById("resultOfManipulation").textContent = zjobs.length+" rerun as per ps25 found"
							//zjobsTemp.splice( zjobsRecoveryFailed.indexOf(zjobsTemp[h]), 1) //remove job zjobs array
							//console.log(zjobsTemp)
						}	
					}
				}
		
				return;
			}
			
			if( where == "NO RECOVERY REQUIRED" || where == "RECOVERY" ){ //mc subjob || rerun subjob
				if( zjobs.length == 0 ){ //super job; found 0 in searching zjobs in forLoop() above;
					//var jobname =  emailSubject.split("|")[1].split(" ")[2];
					var jobname =  emailSubject.substring( emailSubject.indexOf("Z")).replace(/\s+/g, "").split("-")[0]; //best way of extracting zjob in subjectMail,
						zjobsTemp.push(jobname)
						zjobs = zjobsTemp;
						console.log(zjobsTemp)
				}else{
					// search job duplication in thread->don't notify
					for( var g = myArray.length; g <= mySecondArray.length-1; g++){ 
						var lineN = mySecondArray[g];
						if( lineN.indexOf( "Z" ) >= 0 ){ 
							for( var h=0; h < zjobsTemp.length; h++ ){
								if( lineN.indexOf( zjobsTemp[h] ) >= 0 && lineN.indexOf("NO RECOVERY REQUIRE") >= 0 ){//there is already job in threads
									zjobs.splice( zjobsTemp.indexOf(zjobsTemp[h]), 1) //remove job zjobs array
								}
							}
						}
					}
					console.log("duplicate found!")
				}
			}
			
			if( where == "longRunning" ){//for longRunning notify only
			 console.log(zjobs)
				var mySecondArray = fullEmail.split("\n");
				zjobs = zjobsTemp;
				//console.log(mySecondArray[1].indexOf("dts@msg.ti.com [mailto:dts@msg.ti.com]"));
				//only when notify || search job duplication in thread->don't notify
				for( var g = myArray.length; g < mySecondArray.length; g++){
					var lineN = mySecondArray[g];
					//var indexOfAutoEmail = 0;
					if( lineN.indexOf( "From: dts@msg.ti.com [mailto:dts@msg.ti.com]" ) >= 0  ){
						var from = lineN.indexOf( "From: dts@msg.ti.com [mailto:dts@msg.ti.com]" );
						var fromNumberline = mySecondArray.indexOf(mySecondArray[g]);
						var indexOfAutoEmail = fromNumberline;
						console.log(indexOfAutoEmail)
					}
					if( lineN.indexOf( "Z" ) >= 0 ){ 
						for( var h=0; h < zjobsTemp.length; h++ ){
							if( lineN.indexOf( zjobsTemp[h] ) >= 0  && !(g>indexOfAutoEmail)  ){//there is already job in threads until first line of AutoEmail
								//&& lineN.indexOf( zjobsTemp[m]) < fromNumberline
								//console.log( fromNumberline <  )
								console.log("!g<AE->" + g +"<"+indexOfAutoEmail )
								//console.log( lineN.indexOf( zjobsTemp[h] ) + " == " + lineN) //if found duplicate
								zjobs.splice( zjobsTemp.indexOf(zjobsTemp[h]), 1) //remove job zjobs array
							}
						}
					}
				}
			}
			
			if( where == "WAITING T/S"  ){ //notify programmer //for abend notify  only
			//console.log("here")
			//console.log(zjobs)
				if( zjobs.length == 0 ){ //single job; found 0 in searching zjobs for loop() above;
					var jobname =  emailSubject.substring( emailSubject.indexOf("Z")  )  
					//var jobname =  emailSubject.split("|")[1].split(" ")[2];
						zjobsTemp.push(jobname)
						console.log(zjobsTemp)
				}
			
				////////////////////////////////////////////////////
				//only when notify || search job duplication in thread
				//var mySecondArray = fullEmail.split("\n");
				zjobs = zjobsTemp;
				//if job was rerun failed,skip the for loop below, then notify
				for(var i=0; i < myArray.length; i++){
					var lineN = myArray[i];
					if( lineN.indexOf( "Z" ) >= 0 ){ 
						for( var m=0; m < zjobsTemp.length; m++ ){
							if( lineN.indexOf( zjobsTemp[m] )>= 0 && lineN.indexOf("RECOVERY FAILED") > 0 ){
								console.log("job rerun failed")
								return;
							}
						}
					}
				}

				//only when notify || search job duplication in thread->don't notify
				for( var l = myArray.length; l < mySecondArray.length; l++){
					var lineN = mySecondArray[l];
					if( lineN.indexOf( "Z" ) >= 0 ){
						for( var m=0; m < zjobsTemp.length; m++ ){
							//lineN.trim().indexOf("Z") >= 0 && lineN.trim().indexOf("Z") < 3
							//if( lineN.indexOf( zjobsTemp[m] ) >= 0 ){//there is already job in threads
							if( lineN.trim().indexOf( zjobsTemp[m] )>= 0 && lineN.trim().indexOf( zjobsTemp[m] ) <3 ){//there is already job in threads
								//&& lineN.indexOf( zjobsTemp[m]) < fromNumberline
								if( emailSubject.indexOf("LONG") <0  ){// if subjectName is longRunning-Abend, dont delete
									console.log( lineN.indexOf( zjobsTemp[m] ) + " == " + lineN)
									zjobs.splice( zjobsTemp.indexOf(zjobsTemp[m]), 1) //remove job zjobs array
								}
							}
						}
					}
				}
			}
	
			if( where == "holdRelease" ){ //hold and release
				var mySecondArray = fullEmail.split("\n");
				// search job duplication in thread->don't notify
				for( var g = myArray.length; g < mySecondArray.length; g++){ 
					var lineN = mySecondArray[g];
					if( lineN.indexOf( "Z" ) >= 0 ){ 
						for( var h=0; h < zjobsTemp.length; h++ ){
							//str.search(/\bWidget\b/)
							if( lineN.indexOf(zjobsTemp[h]) >= 0 ){//there is already job in threads that has been held | released
								console.log("before: "+zjobs)
								console.log("remove: " +zjobsTemp[h]);
								zjobs.splice( zjobsTemp.indexOf(zjobsTemp[h]), 1) //remove job zjobs array
								console.log("after: "+zjobs)
							}
						}
						zjobsTemp = zjobs;
					}
				}
				console.log("after trimming: " +zjobs)
				if( zjobs.length > 0 ){
					var tempZjobs = [];
					for( var i = 0; i < zjobs.length;i++){
						tempZjobs.push( zjobs[i].substring(0, zjobs[i].indexOf(' ')).trim() )
					}
					zjobs = tempZjobs;
				}
			}			
			
			if( where == "stuck" ){ //stuck in submit
				zjobs = zjobsTemp;
				var mySecondArray = fullEmail.split("\n");
				// search job duplication in thread->don't notify
				for( var g = myArray.length; g <= mySecondArray.length; g++){ 
					var lineN = mySecondArray[g];
					if( lineN.indexOf( "From: dts@msg.ti.com [mailto:dts@msg.ti.com]" ) >= 0  ){
						var from = lineN.indexOf( "From: dts@msg.ti.com [mailto:dts@msg.ti.com]" );
						var fromNumberline = mySecondArray.indexOf(mySecondArray[g]);
						var indexOfAutoEmail = fromNumberline;
						break;
					}else{
						if( lineN.indexOf( "Z" ) >= 0 ){ 
							for( var h=0; h < zjobsTemp.length; h++ ){
								if( lineN.indexOf( zjobsTemp[h] ) >= 0  ){//there is already job in threads
									zjobs.splice( zjobsTemp.indexOf(zjobsTemp[h]), 1) //remove job zjobs array
								}
							}
						}
					
					}
					
				}
				
				if( zjobs.length == 0 ){ //single job; found 0 in searching zjobs for loop() above;
					var jobname =  emailSubject.substring( emailSubject.indexOf("Z")  )  
					//var jobname =  emailSubject.split("|")[1].split(" ")[2];
						zjobsTemp.push(jobname)
						console.log(zjobsTemp)
				}

			}

			if( where == "cleanUp" ){ //clean up
				//zjobs = zjobsTemp;
				var mySecondArray = fullEmail.split("\n");
				// search job duplication in thread->don't notify
				for( var g = myArray.length; g <= mySecondArray.length-1; g++){ 
					var lineN = mySecondArray[g];
					if( lineN.indexOf( "Z" ) >= 0 ){ 
						for( var h=0; h < zjobsTemp.length; h++ ){
							if( lineN.indexOf( zjobsTemp[h] ) >= 0  ){//there is already job in threads
								zjobs.splice( zjobsTemp.indexOf(zjobsTemp[h]), 1) //remove job zjobs array
							}
						}
					}
				}	

			}
			
			if( where == "cancelled" ){ //cancelled
				//zjobs = zjobsTemp;	
				if( zjobs.length == 0 ){
					//zjobs = [emailSubject];
					zjobs = ["Undefined"];
				}
			}
			
			//zjobs = result;
			//return result;
			
			//var line12 = myBody.split("\n")[12]; 
			//console.log(myBody.split("\n")[12].indexOf("Z")); //extract every job
			//console.log(line12.substring(0, 11));
		}
		function solveTimeColumnsForMC(myBody,fullEmail,convertedDate,timeResult){
			//get the time of the job when it was notified ::: WAITING T/S INIT
			//cellSixAbend = timeResult;
			/*To be continued... */
			var myArray = myBody.split("\n");
			var timeResult;
			var cellSixAbend;
			//console.log( fullEmail.split("Sent:")[0] )
			var mySecondArray = fullEmail.split("\n");
			var previousEmailThread = fullEmail.slice(fullEmail.split("Sent:", 1).join("Sent:").length , fullEmail.split("Sent:", 1).join("Sent:").length+50);
				var sentValue =""; 
				var tempSentValue;
				//get time in Sent: where zjob located
				//what if duplicate found(zjob - - - WAITING T/S INIT)..then search the last occurence
				//get index of the zjob
				//get index of Sent:
			for( var j = myArray.length; j <=mySecondArray.length-1; j++ ){
				var lineN = mySecondArray[j];
				( lineN.indexOf("Sent:") >=0 ) ? tempSentValue=lineN.slice( lineN.split(":", 2).join(":").length-2,lineN.split(":", 2).join(":").length+7).trim() : "" //first get the Sent: value
				if( lineN.indexOf(zjobs[0]) >= 0 && lineN.indexOf("WAITING T/S INI") >= 0 ){
					//console.log("found->"+lineN); //found ////get the time of the job when it was notified ::: WAITING T/S INIT
					sentValue = tempSentValue;
					//break;
				}
			}
			console.log("sentValue-> "+sentValue)
			if( sentValue != "" ){ //find the difference			
				///////////////////////////////
				var difference = Math.round( ((( timeStringConverter( convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1])-timeStringConverter(sentValue) )) /1000)/60 )							
				console.log("difference-> ("+convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1]+"-" +sentValue+") " + difference + " minutes")
				if( difference >= 119  ){ // > minutes ---(i.e)---> mc if no response in 2hours(120mins-YR) | (15mins-Y2)
					//adjust time column in 2 hours
					//["11:16 AM", "11", "16", "AM"]
					sentValue.split(":")[0] > 12 ? sentValue = sentValue+" PM" : sentValue = sentValue+" AM"
					var d = new Date();
					var hours;
					var minutes = parseInt(sentValue.split(":")[1], 10);
					if( sentValue.split(" ")[1] == "AM" ) { //+2 hours
						hours = parseInt(sentValue.split(":")[0], 10)+2
					}else{ //+hours
						(sentValue.split(":")[0] == 12) ? hours=parseInt(sentValue.split(":")[0], 10)+2 : hours=parseInt(sentValue.split(":")[0], 10) + 14 
					}
					d.setHours(hours);
					d.setMinutes(minutes)
					sentValue = d.getHours()+":"+d.toTimeString().split(":")[1];
					console.log("timeResult-> "+sentValue)
					//////////////////////////////
					timeResult = sentValue //column 4 abend table
					cellSixAbend =  convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1]
				}
				
			}else{
				timeResult = convertedDate.toTimeString().split(" ")[0].split(":")[0] +":" +timeResult.split(":")[1];//column 4 abend table
				cellSixAbend =  convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1]
			}
			
			return [timeResult,cellSixAbend]
			
		}
		function displayRow(zjobs,site,convertedDate,timeResult,action,logType,recipients,globalEmailSubject,emailIndex,fullEmail,myBody){
			//(logType == "abend") ? (var newRow = abendsTbody.insertRow(-1)):(var newRow = longRunningTbody.insertRow(-1));
			var t1 = $('#abendsTable').DataTable();
			var t2 = $('#longRunningTable').DataTable();
			var cellOne;
			var cellTwo;
			var cellTwoAbend
			var cellThree;
			var cellFour;
			var cellFive;
			var cellFiveLongRun;
			var cellSix;
			var cellSixAbend;
			var cellSeven;
			
			console.log(zjobs)
			
			if( zjobs.length == 1 || logType === "pcn"){ //single zjob
				if( logType === "abend" ) {
					if( site != "Undefined"){
						cellTwoAbend = site;
					}else{
						cellTwoAbend = "Undefined"
					}
				}
				//newRow.insertCell(-1).innerHTML = convertedDate.toJSON().split("T")[0];
				cellTwo = convertedDate.toJSON().split("T")[0];
				//newRow.insertCell(-1).innerHTML = timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1];
				//cellThree = timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1];
				cellThree = timeResult;
				//newRow.insertCell(-1).innerHTML = action;
				cellFour = action;
				
				if( logType === "turnover" ||  logType === "capping"  || logType === "cleanUp" ){
					cellFiveLongRun = "Undefined";
					
					//newRow.insertCell(-1).innerHTML = timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1];//time of action
					//cellSix = timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1];
					cellSix = timeResult;
				
						cellSeven = globalEmailSubject +"(" + recipients + ")";
				}
				
				//function solveTimeForMC(){	
				//}
				
				if(logType === "abend"){
					if( action == "rerun as per ps25" || action == "mark complete as per ps25" ){ //if rr as per ps25, same time
						//newRow.insertCell(-1).innerHTML = timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1];
						//cellSixAbend = timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1];
						if( action == "mark complete as per ps25" ){
							var myVariables = solveTimeColumnsForMC(myBody,fullEmail,convertedDate,timeResult)
							timeResult =  myVariables[0];
							cellSixAbend = myVariables[1];
						}
						
						if( action == "rerun as per ps25" ){
							cellSixAbend = timeResult;
						}
					}else{
						//newRow.insertCell(-1).innerHTML = convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1];
						cellSixAbend = convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1];
						console.log(convertedDate.toTimeString().split(" ")[0])
					}
						cellSeven = globalEmailSubject;
				}
				if( logType == "longRunning" || logType === "pcn" || logType == "holdRelease" || logType == "missedDue" || logType == "stuckInSubmit" || logType == "force" || logType == "inserted" || logType === "cancelled" || logType === "tpipe" || logType == "cleanUp") { //team
						if( recipients.indexOf("data_mart") >= 0 && recipients != null){
							var team = "Datamart";
						}else if ( recipients.indexOf("scssupport") >= 0 || recipients.indexOf("scsops-nt") >= 0){
							var team = "SCS";
						}else if ( recipients.indexOf("firm") >= 0 ){
							var team = "Firm";
						}else if ( recipients.indexOf("logistics") >= 0 ){
							var team = "Logistics";
						}else if ( recipients.indexOf("ap-mmpp") >= 0 ){
							var team = "Ap-mmpp";
						}else if ( recipients.indexOf("obsresv") >= 0 ){
							var team = "Obsersv";
						}else if ( recipients.indexOf("dcit") >= 0 ){
							var team = "Dcit";
						}else if ( recipients.indexOf("emk-dba") >=0 ){
							var team = "Emk-Dba";
						}else if ( recipients.indexOf("hrsprodsup") >= 0 ){
							var team = "Hrsprodsup";
						}else if ( recipients.indexOf("busit") >= 0 ){
							var team = "Tt-ops/Bizzaps";
						}else if ( recipients.indexOf("bizapps") >= 0 ){
							var team = "Tt-ops/Bizzaps";
						}else if ( recipients.indexOf("vendavo") >= 0 ){
							var team = "Vendavo";
						}else if ( recipients.indexOf("wwmit_qms") >= 0 ){
							var team = "wwmit_qms";
						}else if ( recipients.indexOf("fs_oncall") >= 0 ){
							var team = "Fs_oncall";
						}else if ( recipients.indexOf("debatch") >= 0 ){
							var team = "Debatch";
						}else if ( recipients.indexOf("mpder") >= 0 ){
							var team = "Mpder";
						}else if ( recipients.indexOf("sapbw") >= 0 ){
							var team = "Sapbw";
						}else if( recipients.indexOf("sap_yr") >= 0 ){
							var team = "SAP";
						}else{
							var team = "undefined";
						}
						
						if( team != "undefined"){
							cellFiveLongRun = team;
						}else{
							cellFiveLongRun = 	"Undefined";
						}
						
						if(logType == "longRunning"){
							timeResult = timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1]
						}
						//newRow.insertCell(-1).innerHTML = convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1];
						if( logType == "pcn" ){
							//cellSix = timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1];
							cellSix = timeResult;
							
						}else{
							cellSix = convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1];
						
						}
						cellSeven = globalEmailSubject;
				}
				
				//add row in ? table
				if( logType === "abend" ) {
					var temp = t1.row.add( [
						zjobs[0],
						cellTwoAbend,
						convertedDate.toJSON().split("T")[0],
						//timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1],
						timeResult,
						action,
						cellSixAbend,
						globalEmailSubject
					] ).draw( false ).node();
					
					//add popover to TDs
					for(var i =0 ; i<6 ; i++){
						$( temp ).find('td:eq('+i+')').attr({
							'data-email':emailIndex,
							"data-toggle":"popover",
							"data-placement":"bottom",
							"data-trigger":"focus"
						});
					}
					console.log("SUCCESS")
					createSummary(action);
					
				}else{ //Non-abend
					var cellOne = zjobs[0];
					var temp = t2.row.add( [
						zjobs[0],
						convertedDate.toJSON().split("T")[0],
						//timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1],
						timeResult,
						action,
						cellFiveLongRun,
						convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1],
						globalEmailSubject
					] ).draw( false ).node();
					//add popover to TDs
					for(var i =0 ; i<6 ; i++){
						$( temp ).find('td:eq('+i+')').attr({
							'data-email':emailIndex,
							"data-toggle":"popover",
							"data-placement":"bottom",
							"data-trigger":"focus"
						});
					}
						 
					/*
					$(temp).attr({
						'data-email':emailIndex,
						"data-toggle":"popover",
						 "data-placement":"bottom",
						 "data-trigger":"focus"
					 });
						*/		 
					console.log("SUCCESS")
					createSummary(action);
					
				}
			
			}else{ //multiple zjobs
				console.log("multiple zjobs executing..." + zjobs.length)
				if( zjobs.length > 1){
					for(var i=0; i< zjobs.length; i++ ){
					cellOne = zjobs[i];
					if( logType === "abend" ) {
						if( site != "Undefined"){
							cellTwoAbend = site;
						}else{
							cellTwoAbend = "Undefined";	
						}
					}
					//newRow.insertCell(-1).innerHTML = convertedDate.toJSON().split("T")[0];
					cellTwo = convertedDate.toJSON().split("T")[0];
					//newRow.insertCell(-1).innerHTML = timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1];
					cellThree = timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1];
					//newRow.insertCell(-1).innerHTML = action;
					cellFour = action;
					
					if(logType === "abend"){
						if( action == "rerun as per ps25" || action == "mark complete as per ps25" ){ //if rr as per ps25, same time
							if( action == "mark complete as per ps25" ){
								//cellSixAbend = timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1];
								var myVariables = solveTimeColumnsForMC(myBody,fullEmail,convertedDate,timeResult)
									timeResult =  myVariables[0];
									cellSixAbend = myVariables[1];
							}
							if( action == "rerun as per ps25" ){
								cellSixAbend = timeResult;
							}
						}else{
							//newRow.insertCell(-1).innerHTML = convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1];
							cellSixAbend = convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1];
						}
						cellSeven = globalEmailSubject;
					}
				
					if( logType == "longRunning" || logType == "holdRelease" || logType == "missedDue" || logType == "stuckInSubmit"|| logType == "cleanUp" || logType == "force"  || logType === "pcn" || logType == "inserted" || logType === "cancelled" || logType === "tpipe") { //team
						if( recipients.indexOf("data_mart") >= 0 ){
							var team = "Datamart";
						}else if ( recipients.indexOf("scssupport") >= 0 ){
							var team = "SCS";
						}else if ( recipients.indexOf("firm") >= 0 ){
							var team = "Firm";
						}else if ( recipients.indexOf("logistics") >= 0 ){
							var team = "Logistics";
						}else if ( recipients.indexOf("ap-mmpp") >= 0 ){
							var team = "Ap-mmpp";
						}else if ( recipients.indexOf("obsresv") >= 0 ){
							var team = "Obsersv";
						}else if ( recipients.indexOf("dcit") >= 0 ){
							var team = "Dcit";
						}else if ( recipients.indexOf("emk-dba") >=0 ){
							var team = "Emk-Dba";
						}else if ( recipients.indexOf("hrsprodsup") >= 0 ){
							var team = "Hrsprodsup";
						}else if ( recipients.indexOf("busit") >= 0 ){
							var team = "Tt-ops/Bizzaps";
						}else if ( recipients.indexOf("bizapps") >= 0 ){
							var team = "Tt-ops/Bizzaps";
						}else if ( recipients.indexOf("vendavo") >= 0 ){
							var team = "Vendavo";
						}else if ( recipients.indexOf("wwmit_qms") >= 0 ){
							var team = "wwmit_qms";
						}else if ( recipients.indexOf("fs_oncall") >= 0 ){
							var team = "Fs_oncall";
						}else if ( recipients.indexOf("debatch") >= 0 ){
							var team = "Debatch";
						}else if ( recipients.indexOf("mpder") >= 0 ){
							var team = "Mpder";
						}else if ( recipients.indexOf("sapbw") >= 0 ){
							var team = "Sapbw";
						}else if( recipients.indexOf("sap") >= 0 ){
							var team = "SAP";
						}else{
							var team = "undefined";
						}
						
						if( team != "undefined"){
							cellFive = team;
						}else{
							cellFive = "Undefined";
						}
						//newRow.insertCell(-1).innerHTML = convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1];
						cellSix = convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1];
						cellSeven = globalEmailSubject;	

					}
				
					if( logType === "abend" ) {
						var temp = t1.row.add( [
							zjobs[i],
							cellTwoAbend,
							convertedDate.toJSON().split("T")[0],
							timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1],
							action,
							cellSixAbend,
							globalEmailSubject
						] ).draw( false ).node();
						
						//add popover to TDs
						for(var j =0 ; j<6 ; j++){
							$( temp ).find('td:eq('+j+')').attr({
								'data-email':emailIndex,
								"data-toggle":"popover",
								"data-placement":"bottom",
								"data-trigger":"focus"
							});
						}
						
						/*if( site == "Undefined" ){
							abendUndefinedCount++;
							document.getElementById("abendUndefinedDisplayDiv").style.display = "block";
							document.getElementById("abendUndefinedDisplay").textContent = abendUndefinedCount;
							$( temp ).addClass('label-warning');
						}*/
						
						console.log("SUCCESS")
						createSummary(action);
					}else{//Non-abend
						var temp = t2.row.add( [
							zjobs[i],
							convertedDate.toJSON().split("T")[0],
							timeResult.split(" ")[0].split(":")[0] +":" +timeResult.split(" ")[0].split(":")[1],
							action,
							cellFive,
							convertedDate.toTimeString().split(" ")[0].split(":")[0] +":"+convertedDate.toTimeString().split(" ")[0].split(":")[1],
							globalEmailSubject
						] ).draw( false ).node();
						
						//add popover to TDs
						for(var h =0 ; h<6 ; h++){
							$( temp ).find('td:eq('+h+')').attr({
								'data-email':emailIndex,
								"data-toggle":"popover",
								"data-placement":"bottom",
								"data-trigger":"focus"
							});
						}
					
						
						/*	if( cellFive == "Undefined" ){
							nonAbendUndefinedCount++;
							document.getElementById("nonAbendUndefinedDisplayDiv").style.display = "block";
							document.getElementById("nonAbendUndefinedDisplay").textContent = nonAbendUndefinedCount;
							$( temp ).addClass('label-warning');
						 }  */
						
						console.log("SUCCESS")
						createSummary(action);
					}
				}
				}
				
			}
			
				

		}


		//manipulate Time
		//var myDate = emails.Item(1).SentOn;
		//var convertedDate = new Date(myDate);
		//var minuteLess = new Date(convertedDate.setMinutes( convertedDate.getMinutes() - 5 )).toJSON().split("T")[1].split(".")[0];

	
		
		//Excell export..Jake please continue this:)
	//	var ExcelApp = new ActiveXObject("Excel.Application");  
	//var ExcelSheet = new ActiveXObject("Excel.Sheet");
		// Make Excel visible through the Application object.  
	//ExcelSheet.Application.Visible = true;  
	    // Place some text in the first cell of the sheet.  
	//ExcelSheet.ActiveSheet.Cells(1,1).Value = "This is column A, row 1";  
		// Save the sheet.  
	//ExcelSheet.SaveAs("C:\\TEST.XLS");  
		// Close Excel with the Quit method on the Application object.  
	//ExcelSheet.Application.Quit();
	
	</script>

</html>
